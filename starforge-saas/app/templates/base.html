<!DOCTYPE html>
<html lang="{{ lang_code or 'en' }}"
      data-theme="{{ theme or 'dark' }}"
      class="scroll-smooth antialiased bg-zinc-950 text-white font-sans">
<head>
  <!-- ✅ Core Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    {% block title %}
      {{ team.team_name if team and team.team_name else 'Connect ATX Elite' }}
    {% endblock %}
  </title>
  <link rel="canonical" href="{{ request.url_root }}" />

  <!-- 🔍 SEO & Social Meta -->
  <meta name="description" content="{{ team.meta_description if team and team.meta_description else 'Connect ATX Elite — Family-run AAU basketball building future leaders in East Austin.' }}" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <meta name="theme-color" content="{{ team.theme_color if team and team.theme_color else '#facc15' }}" />

  <!-- 🟦 Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{{ team.og_title if team and team.og_title else 'Connect ATX Elite | Empowering Youth' }}" />
  <meta property="og:description" content="{{ team.og_description if team and team.og_description else 'Support our basketball journey and invest in our next generation of leaders.' }}" />
  <meta property="og:image" content="{{ url_for('static', filename=team.og_image) if team and team.og_image else url_for('static', filename='images/logo.webp') }}" />

  <!-- 🐦 Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@ConnectATXElite" />

  <!-- 📱 Icons -->
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename=team.favicon) if team and team.favicon else url_for('static', filename='favicon.png') }}" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename=team.apple_icon) if team and team.apple_icon else url_for('static', filename='images/logo.png') }}" />

  <!-- 🧠 Fonts & Stylesheets -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- 💅 Tailwind & Core CSS -->
  <link rel="preload" as="style" href="{{ url_for('static', filename='css/tailwind.min.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.min.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/globals.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/input.css') }}" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  {% if team and team.custom_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/' ~ team.custom_css) }}" />
  {% endif %}

  {% block head_extra %}{% endblock %}
</head>
<body class="bg-zinc-950 text-white font-sans antialiased {{ team.body_class if team else '' }}">
  <!-- ♿ Accessibility Skip Link -->
  <a href="#main" class="sr-only focus:not-sr-only absolute top-2 left-2 bg-yellow-400 text-black font-semibold px-3 py-1 rounded-lg z-50">
    Skip to main content
  </a>

  {# 🔔 Announcement Bar (optional) #}
  {% block announcement %}{% endblock %}

  {# 🔥 Modular Header #}
  {% include 'partials/header.html' %}

  {# ===================== Flash Messages ===================== #}
  {% include 'partials/flash_and_onboarding.html' %}
  {# Flash AND onboarding live here—this keeps your main content clean #}

  {# 🔧 Main Content #}
  <main id="main" role="main" tabindex="-1">
    {% block content %}{% endblock %}
  </main>

  {# 🧭 Modular Footer #}
  {% include 'partials/footer.html' %}

  {# 🌟 Global Modals (Newsletter, Sponsor, Admin Onboarding, etc) #}
  {% block global_modals %}
    {% include 'partials/newsletter.html' %}
    {# Only include onboarding popover here if NOT in flash partial #}
    {# {% include 'partials/admin_onboarding_popover.html' %} #}
  {% endblock %}

  <!-- ⚙️ JS Libraries (Defer for speed) -->
  <script defer src="{{ url_for('static', filename='js/alpine.min.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/htmx.min.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/aos.js') }}"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (typeof AOS !== 'undefined') AOS.init({ duration: 900, once: true });
    });
  </script>
  <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
  <style>
    @keyframes popIn { 0% { transform: scale(0.86) translateY(60px); opacity: 0.7; } 100% { transform: none; opacity: 1; } }
    .animate-popIn { animation-name: popIn; animation-duration: 0.6s; animation-fill-mode: forwards; }
    #newsletter-popup.visible { display: flex !important; opacity: 1 !important; }
  </style>
  <script type="module">
    import confetti from "https://cdn.skypack.dev/canvas-confetti@1.6.0";
    // Place newsletter popup JS logic in newsletter partial for true modularity!
  </script>

  <!-- 📊 Analytics (Google Tag) -->
  {% if analytics_id %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ analytics_id }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "{{ analytics_id }}");
    </script>
  {% endif %}

  {% block scripts %}{% endblock %}
</body>
</html>

