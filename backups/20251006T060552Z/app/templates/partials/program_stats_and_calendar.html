<style { { nonce_attr() } } { { nonce_attr() } } { { nonce_attr() } } { { nonce_attr() } }>
/* SaaS Pro Section Polish */
.fcx-section, .fcx-section--hero, .fcx-section--tiers {
  max-width: 1100px;
  margin-inline: auto;
  margin-bottom: 3rem;
  padding-inline: clamp(14px, 5vw, 36px);
}
</style>

{% set NONCE = NONCE if NONCE is defined else (csp_nonce if csp_nonce is defined else '') %}
{% set brand_color            = (team.theme_color if team and team.theme_color else '#facc15') %}
{% set donate_init_url        = (safe_url_for('main.donate') if (safe_url_for is defined and has_endpoint('main.donate')) else '/donate') %}
{% set tiers_stats_url        = (safe_url_for('main.stats_json') if (safe_url_for is defined and has_endpoint('main.stats_json')) else '/stats') %}
{% set currency               = (team.currency if team and team.currency else 'USD') %}
{% set stripe_publishable_key = stripe_publishable_key|default('') %}
{% set stripe_payment_link    = (stripe_payment_link if stripe_payment_link is defined and stripe_payment_link else '') %}
{% set team_name              = (team.name if team and team.name else 'FundChamps') %}

<style {{ nonce_attr() }}>
  /* ===== Scoped to #tiers only (no CSS leak) ===== */
  #tiers .section-head{display:flex;align-items:baseline;justify-content:space-between;gap:.75rem}
  #tiers .heading{
    font-weight:1000;letter-spacing:-.02em;
    font-size:clamp(1.6rem,2.8vw,2.25rem);
    background-image:linear-gradient(180deg,#fff 0%, color-mix(in srgb, {{ brand_color }} 72%, #fff) 100%);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 .5px rgba(0,0,0,.65),0 12px 28px rgba(0,0,0,.35);
  }
  @supports not ((-webkit-background-clip:text) or (background-clip:text)){
    #tiers .heading{color:{{ brand_color }};background:none;text-shadow:none}
  }

  /* Controls bar */
  #tiers .controls{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;margin-top:.5rem}
  #tiers .controls .spacer{flex:1}
  #tiers .chip{display:inline-flex;align-items:center;gap:.4rem;padding:.35rem .6rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);font-weight:700;font-size:.85rem;color:#e5e7eb}
  #tiers select{appearance:none;background:#0b0c0f;color:#e5e7eb;border:1px solid rgba(255,255,255,.12);border-radius:.6rem;padding:.45rem .7rem;font-weight:700}

  #tiers .fc-tiers{content-visibility:auto;contain-intrinsic-size:600px}
  #tiers .grid{contain:layout paint}

  /* Flip cards (motion-safe) */
  #tiers .flip-card{perspective:1800px;min-height:400px;cursor:pointer;touch-action:manipulation;position:relative}
  #tiers .flip-card-inner{position:relative;width:100%;height:100%;min-height:372px;transform-style:preserve-3d;will-change:transform;transition:transform .7s cubic-bezier(.4,1.6,.6,1)}
  #tiers .flip-card.card-flipped .flip-card-inner,
  #tiers .flip-card:focus-visible .flip-card-inner,
  #tiers .flip-card:hover .flip-card-inner{transform:rotateY(180deg)}
  #tiers .flip-card-front,#tiers .flip-card-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:1rem;overflow:hidden;z-index:1}
  #tiers .flip-card-back{transform:rotateY(180deg);display:flex;flex-direction:column;align-items:center;justify-content:center}
  @media (prefers-reduced-motion: reduce){ #tiers .flip-card-inner{transition:none!important} }

  /* Glass + spotlight */
  #tiers .glassy-card{
    background:rgba(17,17,17,.58);
    position:relative;isolation:isolate;
    border:1px solid color-mix(in srgb, {{ brand_color }} 26%, transparent);
    box-shadow:0 10px 34px rgba(0,0,0,.38), inset 0 0 0 1px rgba(255,255,255,.06)
  }
  @supports (backdrop-filter: blur(1px)){
    #tiers .glassy-card{
      -webkit-backdrop-filter:blur(16px) saturate(120%);backdrop-filter:blur(16px) saturate(120%);
    }
  }
  #tiers .glassy-card::before{content:"";position:absolute;inset:-1px;border-radius:inherit;pointer-events:none;z-index:0;background:
    radial-gradient(160% 90% at var(--fc-spot-x,50%) var(--fc-spot-y,0%), color-mix(in srgb, {{ brand_color }} 26%, transparent), transparent 55%),
    linear-gradient(to top, rgba(255,255,255,.06), transparent 50%);filter:blur(18px);opacity:.45}
  #tiers .glassy-card::after{content:"";position:absolute;inset:0 0 auto 0;height:38%;background:linear-gradient(to bottom, rgba(255,255,255,.06), transparent);pointer-events:none}
  @media (forced-colors: active){
    #tiers .glassy-card{border:1px solid CanvasText;box-shadow:none}
  }

  /* Price/badges */
  #tiers .price{font-variant-numeric:tabular-nums}
  #tiers .badge{border:1px solid color-mix(in srgb, {{ brand_color }} 20%, transparent);background:rgba(250,204,21,.10)}
  #tiers .ribbon{position:absolute;top:12px;right:-42px;transform:rotate(35deg);background:linear-gradient(90deg,#eab308,#fde68a);color:#111;font-weight:900;font-size:11px;letter-spacing:.02em;padding:.25rem 2.25rem;box-shadow:0 6px 22px rgba(234,179,8,.25)}

  /* Slots meter */
  #tiers .slots{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);margin-top:.5rem}
  #tiers .slots> i{display:block;height:100%;width:0;background:linear-gradient(90deg,#fde047,#facc15);box-shadow:0 0 10px rgba(250,204,21,.35)}

  /* States */
  #tiers .soldout{pointer-events:none;opacity:.58;filter:saturate(.6)}
  #tiers .pulse{animation:tiers-pulse 1100ms ease-out 1}
  @keyframes tiers-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
  /* FAQ ready */
  #tiers details{border:1px solid rgba(255,255,255,.06);border-radius:.75rem;background:rgba(255,255,255,.03)}
  #tiers summary{cursor:pointer;padding:.9rem 1rem;font-weight:700;letter-spacing:-.01em}
  #tiers .faq-a{padding:0 .95rem 1rem;color:#d4d4d8}

  /* === Pulse-in-grid as a 6th card =================================== */
  #tiers .tiers-pulse-cell{ display:flex; border-radius:1rem }
  /* Let Pulse fill the grid cell (remove its 420px cap) */
  #tiers .tiers-pulse-cell #program-pulse-mini .ppm-card{
    max-width:unset; width:100%; height:100%; padding:1rem;
    border:1px solid color-mix(in srgb, {{ brand_color }} 26%, transparent);
    box-shadow:0 10px 34px rgba(0,0,0,.38), inset 0 0 0 1px rgba(255,255,255,.06);
    background:rgba(17,17,17,.58);
  }
  #tiers .tiers-pulse-cell #program-pulse-mini .ribbon{ margin-top:.55rem }

  /* Equal heights for ALL grid items (cards + pulse) */
  #tiers .fc-tiers> [role="listitem"]{ display:flex }
  #tiers .fc-tiers> [role="listitem"]> *{ flex:1; min-height:100% }
</style>

<section id="tiers" class="mt-4" aria-labelledby="tiers-heading">
  <div class="section-head">
    <h2 id="tiers-heading" class="heading" tabindex="0">Sponsorship&nbsp;Tiers</h2>
    <p class="sr-only">Press Enter or Space on a card to flip and see details.</p>
  </div>

  <!-- Controls -->
  <div class="controls" aria-label="Tier controls">
    <label class="chip" for="tiers-monthly">
      <input id="tiers-monthly" type="checkbox" class="accent-yellow-400" />
      Show monthly
    </label>
    <div class="spacer" aria-hidden="true"></div>
    <label class="sr-only" for="tiers-sort">Sort tiers</label>
    <select id="tiers-sort" aria-label="Sort tiers">
      <option value="rec">Sort: Recommended</option>
      <option value="price-desc">Price: High ‚Üí Low</option>
      <option value="price-asc">Price: Low ‚Üí High</option>
      <option value="availability">Availability</option>
    </select>
  </div>

  {% set tiers = tiers if tiers is defined and tiers else [
    {"title":"Platinum","amount":"5,000+","benefits":["Logo on jerseys","Shout-outs on social","VIP invites"],"emoji":"üèÜ","badge":"VIP","fomo":"Only 2 Platinum spots left!","slots_left":2,"price_id":None},
    {"title":"Gold","amount":"2,500","benefits":["Warm-ups logo","Social features","Appreciation invites"],"emoji":"ü•á","popular":true,"fomo":"Most Popular! Limited to 4 sponsors.","slots_left":4,"price_id":None},
    {"title":"Silver","amount":"1,000","benefits":["Social shout-outs","Thank-you certificate","Board listing"],"emoji":"ü•à","fomo":"Recognition on sponsor board.","slots_left":8,"price_id":None},
    {"title":"Bronze","amount":"500","benefits":["Public thank-you","Board listing"],"emoji":"ü•â","fomo":"Perfect for first-timers.","slots_left":12,"price_id":None},
    {"title":"Custom","amount":"Custom","benefits":["Tailored benefits","Personalized impact"],"emoji":"‚ú®","fomo":"We build a package for you.","slots_left":999,"price_id":None}
  ] %}

  <div class="fc-tiers grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
       role="list" aria-label="Available sponsorship tiers"
       id="tiers-grid"
       data-stats-url="{{ tiers_stats_url }}"
       data-donate-url="{{ donate_init_url }}"
       data-has-stripe="{{ '1' if stripe_publishable_key else '0' }}"
       data-spl="{{ stripe_payment_link|e }}"
       data-currency="{{ currency }}"
       data-team="{{ team_name|e }}">

    
    {% for tier in tiers %}
      {% set is_premium = tier.title in ['Gold','Platinum','VIP'] %}
      {% set amt_clean  = 'custom' if tier.amount|string|lower == 'custom' else (tier.amount|string|replace('+','')|replace(',','')) %}
      {% set price_id   = tier.price_id if 'price_id' in tier else None %}
      {% set checkout_url = tier.checkout_url if 'checkout_url' in tier else None %}
      {% set sold_out   = (tier.slots_left is not none and (tier.slots_left|int) <= 0) %}

      <article
        class="flip-card group rounded-2xl outline-none focus:ring-2 focus:ring-yellow-300 {% if sold_out %}soldout{% endif %}"
        tabindex="0" role="listitem" aria-roledescription="sponsorship tier"
        aria-labelledby="tier-{{ loop.index }}-title" aria-describedby="tier-{{ loop.index }}-benefits"
        aria-expanded="false"
        data-tier="{{ tier.title }}" data-amount="{{ amt_clean }}" data-slots="{{ tier.slots_left or 0 }}"
        {% if price_id %}data-price-id="{{ price_id }}"{% endif %}
        {% if checkout_url %}data-checkout-url="{{ checkout_url }}"{% endif %}
        {% set cap_map = {'Platinum':2,'Gold':4,'Silver':8,'Bronze':12,'Custom':999} %}
        data-cap="{{ cap_map.get(tier.title, 12) }}"
        itemscope itemtype="https://schema.org/Offer">

        <meta itemprop="category" content="Sponsorship" />
        <meta itemprop="name" content="{{ tier.title }} Tier" />
        <meta itemprop="priceCurrency" content="{{ currency }}" />
        <meta itemprop="availability" content="https://schema.org/{% if sold_out %}SoldOut{% else %}InStock{% endif %}" />

        <div class="flip-card-inner">
          <!-- FRONT -->
          <div class="flip-card-front glassy-card bg-zinc-900/60 p-5 shadow-xl">
            {% if tier.popular %}<div class="ribbon" aria-hidden="true">Most&nbsp;popular</div>{% endif %}
            <div class="flex items-start justify-between gap-3">
              <div class="flex items-center gap-3">
                <div class="text-2xl" aria-hidden="true">{{ tier.emoji }}</div>
                <div>
                  <h3 id="tier-{{ loop.index }}-title" class="text-xl font-extrabold text-yellow-300">{{ tier.title }}</h3>
                  <p class="text-sm text-zinc-300">
                    {% if tier.amount|string|lower == 'custom' %}
                      <span class="price" data-original="custom" data-monthly="custom">Custom package</span>
                    {% else %}
                      From <span class="price font-semibold text-yellow-200" data-original="${{ tier.amount }}" data-amt="{{ amt_clean }}">{{ "$" ~ tier.amount }}</span>{% if '+' in tier.amount|string %}<span class="opacity-80">+</span>{% endif %}
                      <span class="sr-only">one-time</span>
                    {% endif %}
                  </p>
                </div>
              </div>

              <div class="flex flex-col items-end gap-2 text-right">
                {% if tier.badge %}<span class="badge rounded-full bg-black/50 px-2 py-0.5 text-[11px] font-semibold text-yellow-200">{{ tier.badge }}</span>{% endif %}
                {% if tier.slots_left is not none and tier.slots_left|int <= 4 and tier.slots_left|int> 0 %}
                  <span class="mt-1 text-[11px] text-yellow-200/90" data-slots-left aria-live="polite">Only {{ tier.slots_left }} left</span>
                {% elif sold_out %}
                  <span class="mt-1 text-[11px] text-red-300" data-slots-left aria-live="polite">Sold out</span>
                {% endif %}
              </div>
            </div>

            <ul id="tier-{{ loop.index }}-benefits" class="mt-4 space-y-2 text-sm tier-perks">
              {% for ben in tier.benefits %}
              <li class="flex items-start gap-2">
                <svg viewBox="0 0 20 20" class="mt-0.5 h-4 w-4" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <span>{{ ben }}</span>
              </li>
              {% endfor %}
            </ul>

            <!-- Scarcity meter -->
            <div class="slots" aria-hidden="true"><i></i></div>

            <div class="mt-4 flex items-center gap-2">
              <button
                class="{% if sold_out %}opacity-60 cursor-not-allowed {% endif %}{% if is_premium %}bg-yellow-400 text-black ring-yellow-400/70{% else %}bg-zinc-900 text-yellow-200 border-yellow-400/30{% endif %} inline-flex flex-1 items-center justify-center gap-2 rounded-lg border px-4 py-2 font-bold shadow ring-1 ring-[color:color-mix(in srgb, {{ brand_color }} 20%, transparent)] transition hover:scale-[1.02]"
                data-tier-cta type="button" aria-describedby="tier-{{ loop.index }}-benefits"
                aria-label="Sponsor the {{ tier.title }} tier{% if tier.amount|string|lower != 'custom' %} for ${{ tier.amount }}{% endif %}"
                data-analytics="tiers:cta" {% if sold_out %}disabled{% endif %}>
                Sponsor {{ tier.title }}
                <svg viewBox="0 0 20 20" class="h-4 w-4" fill="currentColor" aria-hidden="true"><path d="M12.293 4.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 11-1.414-1.414L14.586 10H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"/></svg>
              </button>
              <!-- Share -->
              <button type="button" class="chip" data-share aria-label="Share {{ tier.title }} tier">Share</button>
            </div>

            <p class="mt-2 text-xs text-zinc-300/80">Limited spots ‚Ä¢ Fast, secure checkout</p>
          </div>

          <!-- BACK -->
          <div class="flip-card-back border border-[color:color-mix(in srgb, {{ brand_color }} 20%, transparent)] bg-black/70 p-6 text-center shadow-2xl">
            <span class="text-3xl" aria-hidden="true">{{ tier.emoji }}</span>
            <h3 class="mt-2 text-xl font-extrabold text-yellow-300">{{ tier.title }} Tier</h3>
            <p class="mt-2 text-sm text-zinc-200/90">{{ tier.fomo or "Sponsor now for max impact!" }}</p>
            <button
              class="{% if sold_out %}opacity-60 cursor-not-allowed {% endif %}{% if is_premium %}bg-yellow-400 text-black ring-yellow-400/70{% else %}bg-zinc-900 text-yellow-200 border-yellow-400/30{% endif %} mt-4 inline-flex items-center justify-center gap-2 rounded-lg border px-4 py-2 font-bold shadow ring-1 ring-[color:color-mix(in srgb, {{ brand_color }} 20%, transparent)] transition hover:scale-[1.02]"
              type="button" data-tier-cta data-analytics="tiers:cta:back" aria-label="Sponsor the {{ tier.title }} tier now" {% if sold_out %}disabled{% endif %}>
              Become a {{ tier.title }} Sponsor
              <svg viewBox="0 0 20 20" class="h-4 w-4" fill="currentColor" aria-hidden="true"><path d="M12.293 4.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 11-1.414-1.414L14.586 10H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"/></svg>
            </button>
          </div>
        </div>
      </article>
    {% endfor %}

    
    <div class="tiers-pulse-cell" role="listitem" aria-roledescription="program pulse">
      {% include "partials/program_pulse_mini.html" ignore missing with context %}
    </div>
  </div>
</section>

<script {{ nonce_attr() }}type="module" src="{{ url_for('static', filename='js/extracted/partials__program_stats_and_calendar.html__1.js', v='1.0.0') }}"></script>

<script {{ nonce_attr() }} type="application/ld+json" {{ nonce_attr() }}>
{
  "@context": "https://schema.org",
  "@type": "OfferCatalog",
  "name": "Sponsorship Tiers",
  "itemListElement": [
    {% for tier in tiers %}
    {
      "@type": "Offer",
      "name": "{{ tier.title }}",
      "priceCurrency": "{{ currency }}",
      {% if tier.amount|string|lower == 'custom' %}
      "price": "0",
      "description": "{{ (tier.fomo or 'Custom sponsorship package')|e }}"
      {% else %}
      "price": "{{ tier.amount|string|replace(',','')|replace('+','') }}",
      "description": "{{ (tier.benefits|join(', '))|e }}"
      {% endif %}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>

