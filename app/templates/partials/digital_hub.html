<!-- Floating AI Concierge Button -->
<button
  id="ai-concierge-btn"
  class="fixed bottom-16 right-6 z-40 bg-yellow-400 text-zinc-900 rounded-full p-4 shadow-xl hover:scale-110 focus:scale-105 transition-all duration-300 ring-2 ring-yellow-300 hover:ring-yellow-400 focus-visible:ring-4 focus-visible:ring-yellow-400"
  aria-label="Chat with AI Concierge"
  aria-expanded="false"
  aria-controls="ai-concierge"
  type="button"
>
  <span class="sr-only">Open chat</span>ðŸ’¬
</button>

<!-- AI Concierge Modal -->
<dialog
  id="ai-concierge"
  class="fixed inset-0 z-[99999] flex items-center justify-center bg-black/70 backdrop-blur-md transition-opacity duration-300 opacity-0 pointer-events-none closed"
  aria-labelledby="ai-modal-title"
  aria-modal="true"
  tabindex="-1"
>
  <div
    class="relative flex flex-col w-full max-w-md rounded-2xl bg-zinc-900 shadow-2xl overflow-hidden scale-95 opacity-0 transition duration-300 ease-out"
    style="min-width: 330px"
    role="document"
    tabindex="0"
  >
    <header class="flex items-center gap-3 py-4 px-6 bg-gradient-to-r from-yellow-400 via-yellow-200 to-yellow-400">
      <span class="text-2xl" aria-hidden="true">ðŸ¤–</span>
      <h3 id="ai-modal-title" class="flex-1 text-xl font-extrabold text-zinc-900">AI Concierge</h3>
      <button
        type="button"
        class="ml-auto rounded-full bg-zinc-800/40 px-3 py-1 text-xl text-yellow-600 hover:text-red-500 focus-visible:ring-2 focus-visible:ring-yellow-400"
        aria-label="Close chat"
        data-close
      >Ã—</button>
    </header>

    <section
      id="ai-chat-log"
      class="flex-1 overflow-y-auto max-h-[50vh] p-5 bg-black/5 text-yellow-200"
      role="log"
      aria-live="polite"
      aria-relevant="additions"
    >
      <p>Welcome! Ask me anything about the program, events, or fundraising.</p>
    </section>

    <div
      id="typing-indicator"
      class="hidden px-5 pb-2 text-yellow-400 italic select-none text-sm"
      aria-live="polite"
      aria-atomic="true"
    >AI is typingâ€¦</div>

    <div
      class="px-5 py-2 text-xs text-yellow-300 bg-yellow-900/30 text-center select-none"
      role="tooltip"
      aria-label="Keyboard shortcuts"
    >
      Press <kbd class="rounded px-1">ESC</kbd> to close,
      <kbd class="rounded px-1">Cmd/Ctrl + /</kbd> to open chat.
    </div>

    <form
      id="ai-chat-form"
      class="flex gap-2 p-4 bg-zinc-900"
      autocomplete="off"
      aria-label="Send message to AI Concierge"
      novalidate
    >
      <label class="sr-only" for="ai-chat-input">Your message</label>
      <input
        id="ai-chat-input"
        name="message"
        type="text"
        required
        autocomplete="off"
        placeholder="Type your questionâ€¦"
        aria-required="true"
        class="flex-1 rounded-lg bg-zinc-800 px-4 py-2 text-yellow-100 focus:ring-2 focus:ring-yellow-400 outline-none"
        aria-live="polite"
        aria-atomic="true"
      />
      <button
        id="ai-send-btn"
        type="submit"
        class="relative rounded-lg bg-yellow-400 px-4 py-2 font-bold text-black hover:bg-yellow-300 focus-visible:ring-2 focus-visible:ring-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled
      >
        Send
      </button>
    </form>
  </div>
</dialog>

<style>
  /* Modal open/close transitions */
  #ai-concierge:not(.closed) {
    opacity: 1 !important;
    pointer-events: auto !important;
    transition: opacity 0.22s cubic-bezier(.4,0,.2,1);
  }
  #ai-concierge.closed {
    opacity: 0 !important;
    pointer-events: none !important;
    transition: opacity 0.18s cubic-bezier(.4,0,.2,1);
  }
  #ai-concierge > div {
    opacity: 1 !important;
    transform: scale(1) !important;
    transition: opacity 0.3s, transform 0.28s cubic-bezier(.4,0,.2,1);
  }
  #ai-concierge.closed > div {
    opacity: 0 !important;
    transform: scale(0.97) !important;
  }

  /* Typing Indicator */
  #typing-indicator {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.3s, transform 0.3s;
  }
  /* Tooltip */
  #ai-concierge .text-xs {
    font-size: 0.8rem;
  }
  /* Responsive: mobile button placement */
  @media (max-width: 640px) {
    #ai-concierge-btn { right: 1rem; bottom: 5.5rem; }
    #ai-concierge { align-items: flex-end; }
  }
</style>

<script>
  // Elements
  const aiBtn = document.getElementById('ai-concierge-btn');
  const aiModal = document.getElementById('ai-concierge');
  const closeBtn = document.querySelector('[data-close]');
  const input = document.getElementById('ai-chat-input');
  const sendBtn = document.getElementById('ai-send-btn');
  const chatLog = document.getElementById('ai-chat-log');
  const typingIndicator = document.getElementById('typing-indicator');

  // Toggle modal open/close
  aiBtn.addEventListener('click', () => {
    const isClosed = aiModal.classList.contains('closed');
    if (isClosed) openModal();
    else closeModal();
  });
  closeBtn.addEventListener('click', closeModal);

  // Open modal
  function openModal() {
    aiModal.classList.remove('closed');
    document.body.style.overflow = 'hidden';
    aiBtn.setAttribute('aria-expanded', 'true');
    input.focus();
  }
  // Close modal
  function closeModal() {
    aiModal.classList.add('closed');
    document.body.style.overflow = '';
    aiBtn.setAttribute('aria-expanded', 'false');
    aiBtn.focus();
  }

  // Enable/disable send button based on input value
  input.addEventListener('input', () => {
    sendBtn.disabled = input.value.trim() === '';
  });

  // Handle form submission (demo, replace with real AI call)
  document.getElementById('ai-chat-form').addEventListener('submit', (event) => {
    event.preventDefault();
    const message = input.value.trim();
    if (!message) return;

    // Append user message
    chatLog.innerHTML += `<p><strong>You:</strong> ${escapeHtml(message)}</p>`;
    input.value = '';
    sendBtn.disabled = true;

    // Show typing indicator
    typingIndicator.classList.remove('hidden');
    chatLog.scrollTop = chatLog.scrollHeight;

    // Simulate AI response (replace with API)
    setTimeout(() => {
      typingIndicator.classList.add('hidden');
      chatLog.innerHTML += `<p><strong>AI:</strong> Hereâ€™s a helpful answer.</p>`;
      chatLog.scrollTop = chatLog.scrollHeight;
    }, 1400);
  });

  // Escape HTML to prevent injection
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
    });
  }

  // Keyboard shortcuts: ESC to close, Cmd/Ctrl + / to toggle
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !aiModal.classList.contains('closed')) {
      e.preventDefault();
      closeModal();
    }
    if ((e.metaKey || e.ctrlKey) && e.key === '/') {
      e.preventDefault();
      if (aiModal.classList.contains('closed')) openModal();
      else closeModal();
    }
  });

  // Optional: Auto-focus on open for a11y
  aiModal.addEventListener('close', () => {
    aiBtn.focus();
  });
</script>

