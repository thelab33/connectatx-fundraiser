{# --- Sponsor Card Macro --- #}
{% macro sponsor_card(sponsor, idx) %}
  {% set tier = sponsor.tier | default('default') %}
  {% set tier_styles = {
    'Platinum': 'bg-yellow-300 text-yellow-900 shadow-xl-gold ring-2 ring-yellow-400',
    'Gold':     'bg-yellow-200 text-yellow-800 shadow-lg ring-1 ring-yellow-300',
    'Silver':   'bg-yellow-100 text-yellow-700 ring-1 ring-yellow-200',
    'Bronze':   'bg-orange-200 text-orange-900 ring-1 ring-orange-300',
    'default':  'bg-indigo-900 text-yellow-300 ring-1 ring-indigo-600',
  } %}
  {% set tier_emojis = {
    'Platinum': 'ü•á', 'Gold': 'ü•à', 'Silver': 'ü•â', 'Bronze': 'üèÖ', 'default': 'üèÜ',
  } %}
  {% set logo_src = (
    sponsor.logo if sponsor.logo and sponsor.logo.startswith('http') else
    (url_for('static', filename='images/sponsors/' ~ sponsor.logo) if sponsor.logo else url_for('static', filename='images/logo.webp'))
  ) %}
  <article
    tabindex="0"
    aria-label="{{ sponsor.name or 'Sponsor' }}"
    aria-describedby="tooltip-{{ idx }}"
    role="listitem"
    itemscope itemtype="https://schema.org/Organization"
    itemprop="sponsor"
    class="group relative flex flex-col items-center p-6 rounded-3xl transition-transform duration-300 bg-opacity-90 shadow-lg hover:scale-[1.06] hover:shadow-2xl focus-visible:ring-4 focus-visible:ring-yellow-400 focus:outline-none {{ tier_styles.get(tier) }}"
  >
    {% if tier in ['Platinum','Gold'] %}
      <span class="absolute top-2 right-2 animate-pulse text-yellow-400 text-2xl drop-shadow-lg select-none">‚ú®</span>
    {% endif %}
    {% if sponsor.url %}<a href="{{ sponsor.url }}" target="_blank" rel="noopener sponsored" tabindex="-1" aria-label="Visit {{ sponsor.name }}">{% endif %}
      <img src="{{ logo_src }}" alt="{{ sponsor.name }} logo" width="96" height="96"
        class="w-24 h-24 mb-4 rounded-full bg-white shadow-lg object-cover grayscale transition group-hover:grayscale-0 group-hover:scale-110 border-4 border-yellow-400/70"
        loading="lazy" decoding="async" />
    {% if sponsor.url %}</a>{% endif %}
    <h3 class="text-2xl font-extrabold text-yellow-900/95 group-hover:text-yellow-700 drop-shadow-sm tracking-tight">{{ sponsor.name }}</h3>
    <span class="font-mono text-xl text-yellow-900/90 mt-1">${{ sponsor.amount|int|comma }}</span>
    <span class="inline-block px-3 py-1 rounded-full text-sm font-bold uppercase tracking-wide mt-3 select-none bg-black/10 text-black shadow {{ tier_styles.get(tier).split(' ')[0] }}">
      {{ tier_emojis.get(tier) }} {{ tier if tier!='default' else 'Champion' }}
    </span>
    <div id="tooltip-{{ idx }}" role="tooltip"
      class="absolute bottom-[-2.5rem] left-1/2 -translate-x-1/2 rounded-lg bg-black/90 px-3 py-1 text-xs text-yellow-200 opacity-0 transition-opacity duration-200 group-hover:opacity-100 pointer-events-none">
      {{ sponsor.tooltip or 'Thank you for supporting us!' }}
    </div>
  </article>
{% endmacro %}

{# --- Spotlight Wall Section --- #}
<section
  id="sponsor-spotlight"
  class="relative z-20 my-20 px-4 sm:px-8 max-w-6xl mx-auto"
  role="region"
  aria-labelledby="sponsor-spotlight-heading"
  tabindex="-1"
>
  <h2
    id="sponsor-spotlight-heading"
    class="mb-10 text-center text-4xl font-extrabold bg-gradient-to-r from-yellow-400 via-amber-200 to-yellow-400 bg-clip-text text-transparent drop-shadow-xl animate-shine"
  >
    üèÜ Sponsor Spotlight Wall
    <span class="block mt-2 text-base font-semibold text-yellow-300/80 animate-fade-in" aria-live="polite" aria-atomic="true">
      {{ sponsors_sorted|length or 0 }} Champions | ${{ sponsors_total|int|comma|default(0) }} raised
    </span>
  </h2>

  {% set demo_sponsor = {
    "name": "ESPN",
    "logo": "https://upload.wikimedia.org/wikipedia/commons/2/2f/ESPN_wordmark.svg",
    "url": "https://espn.com",
    "amount": 5000,
    "tier": "Platinum",
    "tooltip": "Official Broadcast Sponsor ‚Äì Sports bring communities together!"
  } %}
  {% set demo_sponsors = [demo_sponsor] + (sponsors_sorted if sponsors_sorted else []) %}
  {% set total_slots = 4 %}

  <div class="grid gap-8 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 justify-center mx-auto max-w-4xl" role="list" aria-label="Top Sponsors">
    {% for sponsor in demo_sponsors[:total_slots] %}
      {{ sponsor_card(sponsor, loop.index) }}
    {% endfor %}
    {% for _ in range(total_slots - (demo_sponsors|length if demo_sponsors|length < total_slots else total_slots)) %}
      <div class="flex min-w-[200px] h-[255px] flex-col items-center justify-center rounded-3xl border-2 border-dashed border-yellow-400 bg-zinc-900/60 text-yellow-300/80 shadow-inner transition hover:scale-105 animate-pulse" role="listitem" tabindex="0" aria-label="Available sponsorship spot">
        <span class="text-2xl" aria-hidden="true">‚ú®</span>
        <span class="mt-4 text-center font-bold">This spot is waiting for you!</span>
        <button onclick="openSponsorModal()" class="mt-4 rounded-full bg-yellow-400 px-6 py-2 font-extrabold text-black shadow-lg transition hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400" aria-label="Become a Sponsor" type="button">
          üåü Become a Sponsor
        </button>
      </div>
    {% endfor %}
  </div>

  {# --- Ribbon of All Sponsors (Social Proof + FOMO) --- #}
  <div class="mt-8 mb-3 flex flex-wrap justify-center gap-3" aria-label="All sponsor logos">
    <img src="{{ demo_sponsor.logo }}" alt="ESPN logo" title="ESPN (Demo Sponsor)" class="h-14 w-14 rounded-full bg-white object-contain shadow-inner grayscale transition duration-300 hover:grayscale-0 hover:scale-110 border-2 border-yellow-400/70" loading="lazy" decoding="async" />
    {% for sponsor in sponsors_sorted[:7] %}
      {% set logo_src = (
        sponsor.logo if sponsor.logo and sponsor.logo.startswith('http') else
        (url_for('static', filename='images/sponsors/' ~ sponsor.logo) if sponsor.logo else url_for('static', filename='images/logo.webp'))
      ) %}
      <img src="{{ logo_src }}" alt="{{ sponsor.name or 'Sponsor' }} logo" title="{{ sponsor.name or 'Sponsor' }}" class="h-14 w-14 rounded-full bg-white object-cover shadow-inner grayscale transition duration-300 hover:grayscale-0 hover:scale-110" loading="lazy" decoding="async" />
    {% endfor %}
    <span class="ml-2 inline-flex items-center rounded-full bg-zinc-800 px-3 py-1 text-xs font-bold text-yellow-200 shadow">+ Your Brand Here</span>
  </div>
</section>

