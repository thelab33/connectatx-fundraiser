{# ================= FundChamps • Newsletter Modal (Elite, Single-File, Premium) ================= #}
{% set team_name      = team.team_name|default('Connect ATX Elite', true) %}
{% set subscribe_url  = (safe_url_for('newsletter.subscribe') if (has_endpoint is defined and has_endpoint('newsletter.subscribe')) else '/newsletter/subscribe') %}
{% set csrf           = (csrf_token() if csrf_token is defined else '') %}
{# Optional extras (override from view) #}
{% set require_consent = require_consent if require_consent is defined else false %}
{% set privacy_url     = privacy_url if privacy_url is defined else '/privacy' %}
{% set autoshow_ms     = autoshow_ms if autoshow_ms is defined else 0 %}
{% set exitintent      = exitintent if exitintent is defined else true %}
{% set cap_days        = cap_days if cap_days is defined else 7 %}

<dialog
  id="newsletter-modal"
  class="w-[92vw] max-w-lg rounded-2xl bg-zinc-950/95 p-0 text-zinc-100 shadow-2xl ring-2 ring-yellow-400/30 backdrop:bg-black/60"
  role="dialog"
  aria-modal="true"
  aria-labelledby="newsletter-title"
  aria-describedby="newsletter-desc"
  data-autoshow="{{ autoshow_ms }}"
  data-exitintent="{{ 1 if exitintent else 0 }}"
  data-cap-days="{{ cap_days }}"
>
  <!-- … body/content exactly as in your spec … -->
</dialog>

<style>
  :root { --fc-gold:#facc15; --fc-red:#fca5a5; --fc-green:#34d399; }
  #newsletter-modal::backdrop { background: rgba(0,0,0,.6); transition: background 200ms ease; }
  #newsletter-modal[open] #newsletter-box { animation: fc-pop-in 220ms cubic-bezier(.18,.89,.32,1.28); }
  @keyframes fc-pop-in { 0%{opacity:0;transform:translateY(8px) scale(.98)} 100%{opacity:1;transform:translateY(0) scale(1)} }
  #newsletter-ball { transform-origin:50% 50%; animation: fc-float 3.6s ease-in-out infinite; }
  @keyframes fc-float { 0%,100%{transform:translateY(0) rotate(0)} 50%{transform:translateY(-6px) rotate(3deg)} }
  #swish-confetti:not(.opacity-0){ animation: fc-success 600ms ease-out 1; }
  @keyframes fc-success { 0%{transform:scale(.8);opacity:0} 60%{transform:scale(1.1);opacity:1} 100%{transform:scale(1);opacity:1} }
  #newsletter-form input[aria-invalid='true'] { outline:2px solid var(--fc-red); outline-offset:2px; }
  @media (prefers-reduced-motion: reduce){ #newsletter-modal[open] #newsletter-box,#newsletter-ball,#swish-confetti{animation:none!important;transition:none!important} }
</style>

<script nonce="{{ csp_nonce() if csp_nonce is defined else '' }}">
(() => {
  /* … JS exactly as in your spec (HTMX→fetch fallback, UTM capture, Save-Data/respect, exit-intent,
        frequency cap, confetti, focus trap, public open/close helpers) … */
})();
</script>

