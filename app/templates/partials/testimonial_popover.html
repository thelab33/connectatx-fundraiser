{% set challenge = challenge if challenge is defined and challenge else {} %}
{% set author = challenge.author if challenge and challenge.author else "Team Parent, Class of 2030" %}
{% set detail = challenge.detail if challenge and challenge.detail else "We missed practices due to lack of funding for gym rentals last season. Sponsors make all the difference!" %}

<section
  id="starforge-testimonial-pop"
  class="starforge-popover absolute left-1/2 top-full -translate-x-1/2 mt-3 w-80 bg-black/95 text-yellow-200 rounded-xl px-5 py-4 shadow-xl z-50 hidden animate-fade-in"
  tabindex="-1"
  aria-hidden="true"
  role="dialog"
  aria-modal="false"
  aria-label="Testimonial"
>
  <!-- Pointer Arrow -->
  <div class="absolute top-[-14px] left-1/2 -translate-x-1/2 w-6 h-6 pointer-events-none">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <polygon points="12,0 24,24 0,24" fill="#facc15" opacity="0.8" />
    </svg>
  </div>

  <!-- Testimonial Content -->
  <strong class="block text-yellow-400 mb-1">{{ author }}</strong>
  <div class="text-base leading-relaxed">{{ detail }}</div>

  <!-- Optional Close Button -->
  <button
    type="button"
    onclick="closeTestimonialPopover()"
    class="absolute top-2 right-2 text-yellow-400 hover:text-red-500 text-lg font-bold rounded-full focus:outline-none focus:ring-2 focus:ring-yellow-500"
    aria-label="Close testimonial"
  >
    Ã—
  </button>
</section>

<style>
  /* Popover fade-in animation */
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .animate-fade-in {
    animation: fade-in 0.3s ease-out;
  }

  /* Optional shadow effect for the testimonial box */
  .starforge-popover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }
  
  /* Custom focus outline for accessibility */
  .starforge-popover:focus-visible {
    outline: 3px solid #facc15;
  }
  
  /* Accessibility: Ensure the close button is visible on focus */
  .starforge-popover button:focus {
    outline: 3px solid #facc15;
  }
</style>

<script>
  // Optional script to toggle visibility (if needed for further enhancement)
  document.addEventListener('DOMContentLoaded', () => {
    const popover = document.getElementById('starforge-testimonial-pop');
    const closeButton = popover.querySelector('button');

    // Close the popover on pressing Escape key
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !popover.classList.contains('hidden')) {
        closeTestimonialPopover();
      }
    });

    // Close the popover via button click
    closeButton.addEventListener('click', closeTestimonialPopover);
  });

  // Function to close the popover
  function closeTestimonialPopover() {
    const popover = document.getElementById('starforge-testimonial-pop');
    popover.classList.add('hidden');
    popover.setAttribute('aria-hidden', 'true');
    popover.setAttribute('aria-modal', 'false');
  }

  // Function to open the popover
  function openTestimonialPopover() {
    const popover = document.getElementById('starforge-testimonial-pop');
    popover.classList.remove('hidden');
    popover.setAttribute('aria-hidden', 'false');
    popover.setAttribute('aria-modal', 'true');
    popover.focus();
  }
</script>

