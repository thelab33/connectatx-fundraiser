{% from "macros/ui.html" import render_button %}
{% from "macros/progress.html" import progress_meter %}
{% from "macros/confetti.html" import launch_confetti %}

<header
  id="site-header"
  class="sticky top-0 z-50 bg-black/90 backdrop-blur-xl shadow-2xl border-b border-yellow-400/20 transition-all duration-300"
  x-data="{ mobileOpen: false }"
  @keydown.window.escape="mobileOpen = false"
  itemscope itemtype="https://schema.org/Organization" itemprop="brand"
>

  <!-- Announcement Bar -->
  {% if announcement and announcement.visible %}
  <div
    id="announcement-bar"
    class="flex justify-center items-center gap-2 py-2 px-4 text-sm font-semibold bg-gradient-to-r from-yellow-500 to-yellow-100 text-black shadow-inner"
    hx-get="{{ url_for('main.announcement_partial') }}"
    hx-trigger="every 5m" hx-swap="outerHTML"
    aria-live="polite" aria-atomic="true"
  >
    <span>{{ announcement.message|safe }}</span>
    {% if announcement.cta and announcement.cta_url %}
    <a
      href="{{ announcement.cta_url }}"
      class="underline font-bold hover:no-underline focus-visible:ring-2 ring-black rounded"
      target="_blank" rel="noopener noreferrer"
    >{{ announcement.cta }}</a>
    {% endif %}
    <button
      @click="$el.parentElement.remove()"
      aria-label="Close Announcement"
      class="ml-2 hover:text-red-600 transition"
    >×</button>
  </div>
  {% endif %}

  <!-- Countdown Bar (Fundraising Deadline) -->
  {% if fundraising_deadline %}
  <div class="text-xs font-semibold bg-yellow-800 text-yellow-100 py-1 text-center animate-pulse">
    ⏰ <span id="header-countdown">{{ fundraising_deadline|countdown }}</span> left—help us reach our goal!
  </div>
  {% endif %}

  <!-- Sponsor Marquee -->
  {% include "partials/header_sponsor_ticker.html" ignore missing %}

  <!-- Main Nav & Branding -->
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 md:px-6 py-3">

    <!-- Logo and Team Name -->
    <a
      href="{{ url_for('main.home') }}"
      itemprop="url"
      class="flex items-center gap-3 group"
    >
      <img
        src="{{ team.logo or url_for('static', filename='images/logo.webp') }}"
        alt="{{ team.team_name or 'Connect ATX Elite' }} logo"
        class="h-11 w-11 rounded-full ring-2 ring-yellow-300 shadow-lg transition group-hover:scale-105 bg-white"
      />
      <span class="text-2xl font-extrabold bg-gradient-to-r from-yellow-300 via-yellow-100 to-yellow-50 bg-clip-text text-transparent">
        {{ team.team_name or 'Connect ATX Elite' }}
      </span>
    </a>

    <!-- Desktop Nav + Fundraising Meter + CTAs -->
    <nav class="hidden lg:flex items-center gap-6 text-zinc-200 font-semibold">

      {% for id, label in [('mission','Mission'),('tiers','Sponsorship Tiers'),('program-stats-calendar','Schedule')] %}
      <a
        href="#{{ id }}"
        class="relative px-2 py-1 hover:text-yellow-300 transition group"
      >
        {{ label }}
        <span class="absolute bottom-0 left-0 h-0.5 w-full bg-yellow-300 scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></span>
      </a>
      {% endfor %}

      <!-- Fundraising Meter -->
      {% set raised = funds_raised|default(0)|int %}
      {% set goal = fundraising_goal|default(0)|int %}
      {% if goal > 0 %}
      <div class="flex flex-col items-start ml-4">
        <div class="flex items-baseline gap-2">
          <span class="text-yellow-400 font-extrabold text-lg">
            ${{ raised|comma }}
          </span>
          <span class="text-yellow-100 text-xs">
            / ${{ goal|comma }}
          </span>
          <span class="ml-1 text-yellow-300 text-xs font-black">
            ({{ ((raised/goal*100)|round(1)) }}%)
          </span>
        </div>
        <div class="w-40 mt-1 h-2 bg-zinc-700 rounded-full overflow-hidden">
          <div
            class="h-full bg-gradient-to-r from-yellow-500 to-yellow-300"
            style="width: {{ (raised/goal*100)|round(1) }}%;"
          ></div>
        </div>
      </div>
      {% endif %}

      <!-- Action Buttons -->
      {{ render_button('💸 Donate', '#donate', extra_classes='ml-4') }}
      {{ render_button('🌟 Sponsor', '#tiers', extra_classes='ml-2 bg-gradient-to-r from-yellow-400 to-yellow-200 text-black hover:opacity-90') }}
      {{ render_button('🏆 VIP Sponsor', '#tiers', extra_classes='ml-2 animate-pulse shadow-lg') }}
    </nav>

    <!-- Mobile Menu Toggle -->
    <button
      class="lg:hidden p-2 text-yellow-300"
      aria-label="Menu"
      @click="mobileOpen = !mobileOpen"
    >
      <svg class="w-7 h-7" stroke-width="2" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <!-- Trust Bar -->
  <div class="hidden lg:block text-center py-1 text-xs italic text-yellow-200/80">
    🏅 Trusted by 500+ Families · 3.5 GPA Avg · AAU Gold Certified · Austin, TX · Est. 2023
  </div>

  <!-- Mobile Nav Overlay -->
  <nav x-show="mobileOpen" x-transition class="fixed inset-0 bg-black/95 backdrop-blur flex flex-col items-center justify-center gap-6 lg:hidden z-[60]">
    <button @click="mobileOpen = false" aria-label="Close" class="absolute top-5 right-5 text-4xl text-yellow-300 hover:text-red-500">×</button>
    {% for id, label in [('mission','Mission'),('tiers','Sponsorship Tiers'),('program-stats-calendar','Schedule')] %}
    <a
      href="#{{ id }}"
      @click="mobileOpen = false"
      class="text-3xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent hover:scale-105 transition"
    >{{ label }}</a>
    {% endfor %}
    {{ render_button('🌟 Sponsor Now', '#tiers', size='lg', extra_classes='bg-gradient-to-r from-yellow-400 to-yellow-200 text-black') }}
    {{ render_button('💸 Donate', '#donate', size='lg', extra_classes='mt-2') }}
  </nav>
</header>

<!-- Quick Donate Button (Mobile Only) -->
<a href="#donate" class="fixed bottom-6 right-6 bg-yellow-400 px-6 py-3 rounded-full shadow-2xl animate-bounce lg:hidden">💸 Quick Donate</a>

{% if confetti_triggered %}{{ launch_confetti() }}{% endif %}

