{% extends 'base.html' %}
{# =================== Hero & Fundraiser: FundChamps Elite =================== #}

{# Defensive context: Prevent template errors in dev/demo #}
{% set team = team if team is defined else {"team_name": "Connect ATX Elite"} %}
{% set logo_src = team.logo if team.logo is defined and team.logo else 'images/logo.webp' %}
{% set gym_sponsor = gym_sponsor if gym_sponsor is defined else None %}
{% set raised = raised if raised is defined else 0 %}
{% set goal = goal if goal is defined else 10000 %}
{% set next_practice_date = next_practice_date if next_practice_date is defined else None %}
{% set percent = ((raised / goal) * 100) if goal else 0 %}

<section
  id="hero"
  class="connect-hero relative z-20 flex flex-col items-center justify-center min-h-[92vh] md:min-h-screen overflow-hidden pt-20 md:pt-28 scroll-mt-24 md:scroll-mt-32 bg-gradient-to-r from-blue-800 via-indigo-900 to-blue-700"
  itemscope itemtype="https://schema.org/SportsTeam" tabindex="-1"
>
  <!-- 1️⃣ Responsive, branded team photo (Ken Burns) -->
  <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
    <picture>
      <source media="(max-width: 767px)" srcset="{{ team.hero_image_mobile or url_for('static', filename='images/connect-atx-team-mobile.jpg') }}" />
      <img
        alt="{{ team.hero_image_alt or (team.team_name ~ ' team') if team else 'Demo Team Photo' }}"
        class="w-full h-full object-cover scale-110 opacity-90 animate-kenburns"
        decoding="async"
        loading="eager"
        src="{{ team.hero_image or url_for('static', filename='images/connect-atx-team.jpg') }}"
        role="presentation"
      />
    </picture>
    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent"></div>
  </div>

  <!-- 2️⃣ HERO CONTENT BLOCK -->
  <div class="relative z-10 container mx-auto px-4 py-20 max-w-3xl text-center flex flex-col items-center" data-aos="fade-up">
    {% if team.logo %}
      <img
        alt="{{ team.team_name }} logo"
        class="w-36 h-36 mb-6 rounded-full border-4 border-yellow-300 bg-white/80 shadow-xl animate-fade-in"
        height="128" width="128" itemprop="logo"
        src="{{ team.logo }}"
        loading="eager"
      />
    {% endif %}
    {% if current_user and current_user.is_authenticated %}
      <span class="inline-flex items-center gap-2 px-6 py-2 mb-5 rounded-xl font-semibold text-white bg-gradient-to-r from-yellow-400 to-yellow-200 shadow-lg animate-shine">
        Welcome, {{ current_user.name.split()[0] }}<span class="animate-sparkle">✨</span>
      </span>
    {% endif %}
    <h1 id="hero-heading" class="text-5xl sm:text-6xl font-extrabold tracking-tight bg-gradient-to-r from-yellow-400 via-yellow-500 to-orange-400 bg-clip-text text-transparent drop-shadow-xl animate-slide-up" itemprop="name">
      {{ team.hero_heading or team.team_name or "Your Organization" }}
    </h1>
    <p class="mt-4 text-lg sm:text-xl text-white opacity-90 max-w-xl animate-slide-up delay-100" itemprop="description">
      {{ team.hero_subheading|safe or "Family-run AAU program turning <strong>East Austin</strong> students into honor‑roll athletes and leaders." }}
    </p>
    <a
      href="#tiers"
      class="mt-7 inline-block bg-yellow-400 hover:bg-yellow-300 text-zinc-900 font-bold py-3 px-8 rounded-full shadow-lg transition shimmer-cta animate-pop delay-200 hover:scale-105 focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-300 relative group"
      data-tooltip="Help us reach the championship!"
    >
      Join Our Champion Circle
      <span class="absolute -right-4 top-1/2 -translate-y-1/2 animate-sparkle">🌟</span>
      <span class="sr-only">Join Our Champion Circle</span>
    </a>
    {% if team.featured_logos %}
      <div class="mt-4 flex gap-2 justify-center items-center text-xs opacity-80 hidden md:flex">
        <span class="font-bold text-white">As seen at:</span>
        {% for logo in team.featured_logos %}
          <img alt="{{ logo.alt }}" class="h-5 inline-block" decoding="async" loading="lazy" src="{{ logo.src }}" />
        {% endfor %}
      </div>
    {% endif %}
    <div class="mt-8 flex flex-wrap justify-center gap-4 animate-fade-in delay-500">
      <span class="badge-glass animate-pulse" title="Over 500 families trust us!">🏅 Trusted by 500+ Families</span>
      <span class="badge-glass animate-pulse" title="Team GPA 3.5 and rising!">📚 3.5 Team GPA</span>
      <span class="badge-glass animate-pulse" title="Official AAU Gold Certification">🏀 AAU Gold Certified</span>
    </div>
  </div>

  <!-- 3️⃣ FOMO Gym Rental Card (NO DUPLICATES) -->
  <div class="relative z-10 w-full max-w-lg mx-auto mt-7 mb-2">
    <div class="flex flex-col sm:flex-row items-center justify-between bg-gradient-to-r from-yellow-400/90 via-yellow-300/80 to-yellow-200/90 border-2 border-yellow-300 rounded-2xl px-6 py-3 shadow-xl">
      <div class="text-lg font-bold text-zinc-900 flex-1 text-center sm:text-left">
        🏟️ This Week’s Gym Rental Sponsored By:
        <span class="ml-2 text-yellow-900 font-black">
          {{ gym_sponsor.name if gym_sponsor else "⭐ Available for Sponsorship"}}
        </span>
      </div>
      <div class="text-sm font-semibold text-yellow-900 flex-1 text-center sm:text-right mt-2 sm:mt-0">
        <span class="inline-block">
          <span class="font-bold">Location:</span> {{ gym_sponsor.location if gym_sponsor and gym_sponsor.location else 'TBD' }}
          &nbsp;|&nbsp;
          <span class="font-bold">Practice:</span> {{ gym_sponsor.date if gym_sponsor and gym_sponsor.date else next_practice_date or 'TBD' }}
        </span>
        <button type="button" class="ml-3 px-4 py-1 bg-zinc-900 text-yellow-300 font-bold rounded-full shadow hover:bg-yellow-400 hover:text-zinc-900 transition text-base" onclick="openSponsorModal('gym')" >Sponsor a Gym</button>
      </div>
    </div>
    {% if not gym_sponsor %}
      <div class="text-center mt-2 text-xs text-yellow-800 animate-bounce">👀 Your name could be here next week!</div>
    {% endif %}
  </div>

  <!-- 4️⃣ Fundraising Meter: animated, a11y, Socket.IO ready -->
  <div class="relative z-10 mt-10 w-full max-w-xl mx-auto px-4 animate-fade-in delay-300">
    <section class="w-full bg-black/60 backdrop-blur rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-3 shadow-lg border border-yellow-400/10 mt-4 z-30" role="region">
      <section class="w-full sm:flex-1 relative">
        <div id="hero-meter-bar" role="progressbar" class="h-4 w-full rounded-full bg-zinc-800 overflow-hidden" aria-valuenow="{{ percent | round(0) }}" aria-valuemin="0" aria-valuemax="100">
          <div id="hero-meter-bar-inner" class="h-full bg-gradient-to-r from-yellow-400 to-yellow-200 transition-all duration-700 ease-out rounded-full" style="width: {{ percent | round(1) }}%"></div>
        </div>
        <div id="hero-meter-percent" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xs font-bold text-zinc-900 bg-yellow-300 px-2 py-0.5 rounded-full shadow-lg pointer-events-none select-none animate-sparkle">
          {{ percent | round(0) }}%
        </div>
      </section>
      <section class="text-sm font-semibold text-yellow-300 whitespace-nowrap text-center sm:text-left">
        Raised: $<span id="funds-raised-meter">{{ raised|int }}</span> / $<span id="funds-goal-meter">{{ goal|int }}</span>
        <span id="emoji-milestone" class="ml-2 text-xl">
          {% if percent >= 100 %}🏆
            <span class="text-xl text-yellow-400 font-extrabold animate-pop ml-2">🎉 Goal Achieved! Thank you, Champions! 🎉</span>
          {% elif percent >= 75 %}🚀
          {% else %}💤
          {% endif %}
        </span>
      </section>
    </section>
    <p class="mt-3 text-center text-sm font-semibold text-white">
      💰 <span class="text-yellow-300 font-bold">${{ raised }}</span> raised of <span class="text-yellow-300 font-bold">${{ goal }}</span>
    </p>
  </div>

  <!-- 5️⃣ Scroll Down Floating Cue -->
  <button
    id="scroll-hint-hero"
    class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce focus:outline-none hover:drop-shadow-[0_0_10px_rgba(250,204,21,0.8)] focus-visible:ring-4 focus-visible:ring-yellow-400 transition"
    onclick="window.scrollTo({ top: window.innerHeight * 0.8, behavior: 'smooth' })"
    aria-label="Scroll to next section"
  >
    <svg class="w-8 h-8 text-yellow-400 drop-shadow" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- 6️⃣ Overlay Testimonial/Mission (modular partial) -->
  {% include "partials/hero_overlay_quote.html" ignore missing %}
</section>

<script>
/**
 * Elite FundChamps: Fundraising Meter Live-Update Handler
 * Call this from Socket.IO, Alpine, or HTMX.
 */
function updateFundraisingMeter({ raised, goal }) {
  const pct = (goal ? (raised / goal) * 100 : 0).toFixed(1);
  document.getElementById('hero-meter-bar-inner').style.width = pct + '%';
  document.getElementById('hero-meter-percent').textContent = `${Math.round(pct)}%`;
  document.getElementById('funds-raised-meter').textContent = Number(raised).toLocaleString();
  if (Math.round(pct) >= 100 && !window._confettiLaunched) {
    window.launchConfetti && window.launchConfetti();
    window._confettiLaunched = true;
    document.getElementById('emoji-milestone').classList.add('animate-bounce');
    setTimeout(() => {
      document.getElementById('emoji-milestone').classList.remove('animate-bounce');
    }, 1200);
  }
}
</script>

