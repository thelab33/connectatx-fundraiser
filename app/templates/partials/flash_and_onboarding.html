{# ======================= FLASH MESSAGES (Elite Polish) ======================= #}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div
      id="flash-messages"
      class="fixed inset-x-0 top-4 z-[1050] mx-auto max-w-lg space-y-3 pointer-events-none"
      role="alert"
      aria-live="assertive"
    >
      {% for category, msg in messages %}
        {% set styles = {
          'success': 'bg-gradient-to-r from-green-200/80 to-green-50/90 text-green-900 border-green-300',
          'danger':  'bg-gradient-to-r from-red-200/80 to-red-50/90 text-red-900 border-red-300',
          'info':    'bg-gradient-to-r from-yellow-100/90 to-yellow-50/90 text-yellow-900 border-yellow-300'
        }[category] or 'bg-gradient-to-r from-zinc-100/80 to-zinc-50/90 text-zinc-900 border-zinc-300' %}
        {% set icons = {
          'success': '‚úîÔ∏è',
          'danger':  '‚ùå',
          'info':    '‚ö°'
        }[category] or 'üí°' %}
        <div
          class="flex items-center gap-3 px-5 py-3 rounded-2xl shadow-2xl border-2 backdrop-blur-lg glassy
                 {{ styles }} animate-flash-in pointer-events-auto"
          role="alert"
        >
          <span class="text-xl font-bold select-none">{{ icons }}</span>
          <span class="flex-1 text-base font-semibold">{{ msg }}</span>
          <button
            type="button"
            class="ml-3 px-2 py-1 rounded-full text-2xl leading-none font-black text-zinc-700/70 hover:text-red-500 bg-transparent transition focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-400"
            aria-label="Dismiss message"
            onclick="this.closest('.flex').remove()"
            tabindex="0"
          >&times;</button>
        </div>
      {% endfor %}
    </div>
    <script>
      // Dismiss all with Esc
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') document.getElementById('flash-messages')?.remove();
      });
      // Auto-fade after 4s
      setTimeout(() => {
        document.getElementById('flash-messages')?.classList.add('animate-flash-out');
        setTimeout(()=>document.getElementById('flash-messages')?.remove(), 650);
      }, 4000);
    </script>
    <style>
      @keyframes flash-in {
        from { opacity:0; transform: translateY(-15px) scale(0.98);}
        to { opacity:1; transform: translateY(0) scale(1);}
      }
      @keyframes flash-out {
        from { opacity:1; transform: scale(1);}
        to { opacity:0; transform: translateY(-16px) scale(0.95);}
      }
      .animate-flash-in { animation: flash-in 0.42s cubic-bezier(.4,0,.2,1) both;}
      .animate-flash-out { animation: flash-out 0.6s cubic-bezier(.4,0,.2,1) both;}
      .glassy { background:rgba(255,255,255,0.65); backdrop-filter: blur(10px);}
    </style>
  {% endif %}
{% endwith %}

{# ==================== ONBOARDING POPOVER (Elite/Glassy) ==================== #}
{% if not session.get('onboarded') %}
  <div
    id="onboarding-popover"
    class="fixed bottom-6 right-6 max-w-xs w-full bg-gradient-to-br from-yellow-400/90 via-yellow-100/95 to-white/80 text-black p-6 rounded-2xl shadow-2xl border-2 border-yellow-300 glassy z-[1049] animate-popin"
    role="dialog"
    aria-modal="true"
    aria-labelledby="onboard-title"
    aria-describedby="onboard-description"
    tabindex="0"
  >
    <h2 id="onboard-title" class="font-extrabold text-2xl mb-2 flex items-center gap-2">
      <span class="text-yellow-600 text-3xl">üèÄ</span> Welcome!
    </h2>
    <p id="onboard-description" class="text-base mb-5 font-semibold">
      Explore our mission, meet the squad, and see how you can make a real impact in Austin youth sports. 
      <span class="block text-yellow-900 font-bold mt-2">Become a Champion Sponsor today!</span>
    </p>
    <button
      type="button"
      class="w-full mt-2 py-2 rounded-full bg-black text-yellow-400 font-bold shadow hover:bg-zinc-900 transition focus:outline-none focus:ring-2 focus:ring-yellow-300"
      aria-label="Dismiss onboarding popover"
      onclick="
        fetch('{{ url_for('main.dismiss_onboarding') }}', { method: 'POST', headers:{'X-CSRFToken':'{{ csrf_token() }}'} })
        .then(()=> document.getElementById('onboarding-popover').remove());
      "
      tabindex="0"
    >
      Got it!
    </button>
  </div>
  <style>
    @keyframes popin {
      from { opacity:0; transform: translateY(24px) scale(0.95);}
      to   { opacity:1; transform: translateY(0) scale(1);}
    }
    .animate-popin { animation: popin 0.45s cubic-bezier(.4,0,.2,1) both;}
    .glassy { background:rgba(255,255,255,0.70); backdrop-filter: blur(12px);}
    #onboarding-popover:focus { outline: 2px solid #fbbf24; outline-offset: 4px;}
  </style>
  <script>
    // Focus popover on open for a11y
    setTimeout(() => document.getElementById('onboarding-popover')?.focus(), 300);
    // Esc dismiss
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') document.getElementById('onboarding-popover')?.remove();
    });
  </script>
{% endif %}

