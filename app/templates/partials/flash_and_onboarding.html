{# ─────── Flash Messages ─────── #}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div
      id="flash-messages"
      class="fixed inset-x-0 top-4 mx-auto max-w-lg space-y-2 z-50"
      role="alert"
      aria-live="assertive"
    >
      {% for category, msg in messages %}
        <div
          class="flex items-center justify-between px-4 py-3 rounded-lg shadow-lg
                 {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'danger' %}bg-red-100 text-red-800{% else %}bg-yellow-100 text-yellow-800{% endif %}
                 animate-fade-in"
        >
          <span>{{ msg }}</span>
          <button
            type="button"
            class="ml-4 font-bold text-xl focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-current"
            aria-label="Dismiss message"
            onclick="this.closest('.flex').remove()"
          >&times;</button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<style>
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-fade-in {
    animation: fade-in 0.4s ease-out;
  }
</style>

{# ─────── Onboarding Popover (first-time visitors) ─────── #}
{% if not session.get('onboarded') %}
  <div
    id="onboarding-popover"
    class="fixed bottom-6 right-6 max-w-xs bg-yellow-400 text-black p-4 rounded-xl shadow-2xl z-40 animate-slide-up"
    role="dialog"
    aria-modal="true"
    aria-labelledby="onboard-title"
    aria-describedby="onboard-description"
  >
    <h2 id="onboard-title" class="font-extrabold mb-2 text-lg">Welcome to Connect ATX Elite!</h2>
    <p id="onboard-description" class="text-sm mb-4">
      Explore our mission, meet the team, and consider becoming a champion sponsor today.
    </p>
    <div class="flex justify-end gap-2">
      <button
        type="button"
        class="px-3 py-1 bg-black text-yellow-400 rounded hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-yellow-300"
        aria-label="Dismiss onboarding popover"
        onclick="
          fetch('{{ url_for('main.dismiss_onboarding') }}', { method: 'POST', headers:{'X-CSRFToken':'{{ csrf_token() }}'} })
            .then(()=> document.getElementById('onboarding-popover').remove());
        "
      >
        Got it!
      </button>
    </div>
  </div>
{% endif %}

<style>
  /* Slide-up animation for onboarding popover */
  @keyframes slide-up {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .animate-slide-up {
    animation: slide-up 0.5s ease-out;
  }

  /* Focus state for the dismiss button */
  #onboarding-popover button:focus {
    outline: 2px solid #facc15;
  }
</style>

