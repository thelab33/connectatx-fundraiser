{% if current_user.is_authenticated and current_user.is_admin and not session.get('onboarded') %}
<div
  id="admin-onboarding-popover"
  x-data="{ open: true, steps: Array(3).fill(false) }"
  x-show="open"
  x-transition.opacity.duration.500ms
  @keydown.window.escape="open=false; dismissOnboarding()"
  role="dialog"
  aria-modal="true"
  aria-labelledby="onboard-title"
  tabindex="-1"
  class="fixed bottom-8 right-8 max-w-sm bg-black/90 text-yellow-100 p-6 rounded-2xl shadow-2xl ring-1 ring-yellow-400/20 animate-fade-in focus:outline-none"
  style="backdrop-filter:blur(4px);"
  x-init="setTimeout(launchConfetti,400)"
>
  <h3 id="onboard-title" class="text-2xl font-extrabold text-yellow-300 mb-4 drop-shadow-lg">Welcome, Admin!</h3>

  <!-- Onboarding Steps -->
  <ol class="space-y-3 mb-4 text-sm" aria-label="Onboarding Steps">
    <template x-for="(step, i) in ['Visit Dashboard','Invite Sponsors','Import Contacts']" :key="i">
      <li class="flex items-start gap-2">
        <button
          type="button"
          class="mt-1 w-6 h-6 flex-none rounded-full border-2 border-yellow-300 text-yellow-300 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-yellow-400"
          :class="steps[i] ? 'bg-green-400 border-green-400 text-white' : ''"
          @click="steps[i]=true"
          :aria-checked="steps[i]"
          role="checkbox"
        >
          <span x-show="steps[i]">✔️</span>
        </button>
        <span :class="steps[i] ? 'line-through text-green-300' : ''" class="flex-1">{{ step }}</span>
      </li>
    </template>
  </ol>

  <!-- Quick Actions -->
  <div class="space-y-2 mb-4">
    <a href="/dashboard" @click="steps[0]=true" class="block text-center bg-yellow-400 text-black font-bold py-2 rounded-lg hover:bg-yellow-300 transition">Dashboard</a>
    <a href="/admin/invite" @click="steps[1]=true" class="block text-center bg-yellow-300 text-black font-semibold py-2 rounded-lg hover:bg-yellow-200 transition">Invite Sponsors</a>
    <a href="/admin/import" @click="steps[2]=true" class="block text-center bg-yellow-200 text-black font-semibold py-2 rounded-lg hover:bg-yellow-100 transition">Import Contacts</a>
  </div>

  <p class="text-xs text-yellow-400 mb-4">💡 Need help? Use the AI Concierge (💬) at any time.</p>

  <button
    @click="open=false; dismissOnboarding()"
    class="w-full bg-yellow-500 text-black font-bold py-2 rounded-full shadow-lg hover:bg-yellow-400 transition focus:outline-none focus:ring-2 focus:ring-yellow-500"
    aria-label="Dismiss Onboarding"
  >Got it!</button>
</div>
{% endif %}

<!-- AI Concierge Tooltip -->
<div id="ai-concierge-tip" class="fixed bottom-24 right-12 bg-yellow-400 text-black px-3 py-2 rounded-xl text-xs shadow-lg opacity-0 transform translate-y-2 transition-all">
  👋 Click the chat icon for AI support!
</div>

<script>
  function launchConfetti(){
    import('https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/+esm')
      .then(({default: confetti})=>confetti({particleCount:60,spread:80,origin:{y:0.6}}))
      .catch(()=>{});
  }
  function dismissOnboarding(){
    fetch('{{ url_for("admin.dismiss_onboarding") }}',{method:'POST',headers:{'X-CSRFToken':'{{ csrf_token() }}','Content-Type':'application/json'},body:JSON.stringify({dismissed:true})});
  }
  document.addEventListener('DOMContentLoaded',()=>{
    setTimeout(()=>{
      const tip=document.getElementById('ai-concierge-tip');
      tip.style.opacity=1; tip.style.transform='translateY(0)';
      setTimeout(()=>{tip.style.opacity=0; tip.style.transform='translateY(2rem)';},4000);
    },1500);
  });
</script>

<style>
  /* Fade-in animation */
  @keyframes fadeIn { from{opacity:0;transform:translateY(12px);} to{opacity:1;transform:translateY(0);} }
  .animate-fade-in { animation:fadeIn 0.5s ease both; }

  /* Tooltip Styles */
  #ai-concierge-tip { pointer-events:none; }

  /* Focus state for the popover */
  #admin-onboarding-popover:focus { outline-offset:4px; }

  /* Animated confetti when onboarding steps are completed */
  @keyframes confetti-pop {
    0% { opacity: 0; transform: scale(0.8); }
    100% { opacity: 1; transform: scale(1); }
  }
  .animate-confetti-pop { animation: confetti-pop 0.5s ease-out; }
</style>

