{% from "macros/progress.html" import progress_meter %}
{% from "macros/confetti.html" import launch_confetti %}

{# --- Hero Vars --- #}
{% set team_name = team.team_name | default('Connect ATX Elite', true) %}
{% set region = team.region | default("Austin, TX", true) %}
{% set logo_src = 'images/team-rings.webp' %}
{% set hero_img = (team.hero_image if team and team.hero_image else 'images/connect-atx-team.jpg') %}
{% set fallback_img = url_for('static', filename='images/connect-atx-team.jpg') %}
{% set impact = [
  {"v":"20+", "lbl":"Studentâ€‘Athletes"},
  {"v":"3.5+", "lbl":"GPA Average"},
  {"v":"100%", "lbl":"Funds to Access &amp; Education"}
] %}
{% set raised = stats.raised if stats is defined and stats.raised is defined else 0 %}
{% set goal = stats.goal if stats is defined and stats.goal is defined else 10000 %}
{% set pct = (raised / goal * 100) | round(1) if goal else 0 %}
{% set next_game = team.next_game if team and team.next_game else None %}
{% set next_game_dt = next_game.date if next_game and next_game.date else None %}
{% set recent_donors = recent_donors if recent_donors is defined else [] %}

<section
  id="hero"
  aria-labelledby="hero-heading"
  tabindex="-1"
  itemscope itemtype="https://schema.org/SportsTeam"
  class="relative w-full max-w-full flex flex-col items-center justify-center min-h-[98vh] md:min-h-screen overflow-hidden
         py-36 px-6 sm:px-12 bg-gradient-to-br from-blue-900 via-indigo-950 to-blue-800
         transition-transform duration-500 ease-out will-change-transform hover:scale-105"
  style="margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw);"
>

  <!-- Parallax Background Image -->
  <img
    src="{{ url_for('static', filename=(hero_img if hero_img and '://' not in hero_img else 'images/' ~ hero_img)) }}"
    alt="{{ team_name }} team photo"
    loading="eager"
    decoding="async"
    aria-hidden="true"
    class="absolute inset-0 w-full h-full object-cover opacity-90 scale-110 animate-kenburns-smooth -z-10 pointer-events-none select-none shadow-[0_0_30px_rgba(251,191,36,0.7)]
           transition-transform duration-500 ease-out"
    style="min-height: 520px; max-height: 100vh;"
    onerror="this.onerror=null;this.src='{{ url_for('static', filename='images/connect-atx.jpg') }}';"
    itemprop="image"
  />

  <!-- Gradient Overlays -->
  <div class="absolute inset-0 bg-gradient-to-b from-black/90 via-black/60 to-transparent -z-5"></div>
  <div class="absolute inset-x-0 top-0 h-2 bg-gradient-to-r from-yellow-300/50 via-transparent to-yellow-400/30 blur-lg z-10"></div>
  <div class="absolute left-0 top-0 h-full w-12 bg-gradient-to-r from-yellow-200/10 to-transparent z-10"></div>
  <div class="absolute right-0 top-0 h-full w-12 bg-gradient-to-l from-yellow-200/10 to-transparent z-10"></div>

  <!-- Basketball Net Accent SVG -->
  <svg
    class="absolute left-1/2 top-[calc(100%-36px)] -translate-x-1/2 z-10 w-32 md:w-40 opacity-30 pointer-events-none transition-transform duration-500"
    viewBox="0 0 128 32" fill="none" aria-hidden="true"
  >
    <ellipse cx="64" cy="16" rx="63" ry="12" fill="#fffbe880" />
    <path d="M0 16 Q64 36 128 16" stroke="#eab308" stroke-width="2" fill="none" />
    <path d="M16 16 Q64 32 112 16" stroke="#eab308" stroke-width="1" fill="none" />
  </svg>

  <!-- Main Hero Content Wrapper -->
  <div class="relative z-30 flex flex-col items-center w-full max-w-3xl mx-auto text-center gap-8 px-0 sm:px-6">

    <!-- Logo, Team Name & Subtitle -->
    <div class="flex flex-col items-center mb-4" role="img" aria-label="{{ team_name }} logo">
      <span class="relative inline-block mb-3 animate-fade-in-slow">
        <img
          src="{{ url_for('static', filename=logo_src) }}"
          alt="Connect ATX Elite championship rings"
          class="h-20 sm:h-28 w-auto rounded-full bg-white/80 p-2 drop-shadow-xl ring-4 ring-amber-200/30
                 transition-transform duration-500 hover:scale-105 hover:shadow-lg"
          loading="eager"
          decoding="async"
          itemprop="logo"
        />
        <svg class="absolute -top-6 right-0 animate-spin-slow w-10 h-10 opacity-70" viewBox="0 0 32 32" fill="none" aria-hidden="true">
          <circle cx="16" cy="16" r="15" fill="#FBBF24" stroke="#92400E" stroke-width="2" />
          <path d="M8 16c5-3 11-3 16 0" stroke="#92400E" stroke-width="1" />
          <path d="M16 2v28" stroke="#92400E" stroke-width="1" />
        </svg>
      </span>

      <h1
        id="hero-heading"
        class="text-5xl sm:text-6xl font-extrabold text-yellow-300 tracking-tight leading-tight animate-shine"
        tabindex="0"
        aria-label="{{ team_name }}"
      >
        {{ team_name }}
      </h1>

      <p class="mt-2 text-xl sm:text-2xl font-semibold text-white/95 drop-shadow animate-fade-in-slow">
        Family, Grit &amp; Honor â€” On and Off the Court
      </p>
    </div>

    <!-- Mission Statement -->
    <p
      class="max-w-xl text-yellow-100 font-bold text-lg sm:text-xl leading-relaxed mx-auto animate-fade-in"
      style="animation-delay: 0.3s"
    >
      Weâ€™re a <span class="text-amber-300 font-semibold hover:text-yellow-400 transition-colors duration-300">family-run AAU program</span>
      transforming East Austin youth into
      <span class="text-amber-300 font-semibold hover:text-yellow-400 transition-colors duration-300">scholar-athletes, leaders, and community champions</span>.
    </p>

    <!-- Impact Stats -->
    <div
      class="impact-stats flex flex-wrap justify-center gap-8 max-w-2xl mx-auto mb-10"
      role="list"
      aria-label="Team Impact Stats"
    >
      {% for s in impact %}
      <div
        class="min-w-[100px] bg-black/80 rounded-xl p-5 shadow-lg focus-within:ring-2 focus-within:ring-yellow-400
               flex flex-col items-center animate-pop-in transition-transform duration-300 hover:scale-105 hover:shadow-lg hover:bg-gradient-to-br hover:from-yellow-500 hover:to-yellow-300"
        tabindex="0"
        role="listitem"
        aria-label="{{ s.v }} {{ s.lbl }}"
      >
        <span class="block text-3xl sm:text-4xl font-extrabold text-yellow-300 animate-shine">{{ s.v }}</span>
        <span class="block mt-2 text-xs sm:text-sm uppercase text-yellow-100 tracking-wide text-center">{{ s.lbl }}</span>
      </div>
      {% endfor %}
    </div>

    <!-- VIP Sponsorship Button -->
    <button
      type="button"
      class="inline-flex items-center gap-3 mb-10 px-10 py-3 rounded-full bg-yellow-400 text-zinc-900
             font-extrabold text-sm sm:text-base tracking-wider uppercase shadow-xl animate-bounce-in
             backdrop-blur-xl cursor-pointer focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-500/90
             hover:scale-105 hover:shadow-lg hover:opacity-90 transition-transform duration-300"
      role="alert"
      aria-live="polite"
      aria-atomic="true"
      tabindex="0"
      onclick="window.location.href='/vip'"
      aria-label="Limited VIP Sponsorship - Secure your spot"
    >
      ðŸŒŸ Limited VIP Sponsorship
      <svg
        class="ml-2 w-5 h-5 animate-sparkle"
        fill="none"
        viewBox="0 0 16 16"
        aria-hidden="true"
      >
        <path
          d="M8 1v2M8 13v2M1 8h2M13 8h2M4.22 4.22l1.42 1.42M10.36 10.36l1.42 1.42M4.22 11.78l1.42-1.42M10.36 5.64l1.42-1.42"
          stroke="#fff"
          stroke-width="1.2"
          stroke-linecap="round"
        />
      </svg>
      <span class="mx-3 text-yellow-700 font-bold animate-pulse">â€¢</span>
      <span class="hidden sm:inline">Secure your spot!</span>
    </button>

    <!-- Fundraising Progress Card -->
    <div
      class="flex flex-col items-center w-full max-w-sm mx-auto mb-6 bg-zinc-900/95 rounded-xl p-6
             ring-1 ring-yellow-400/40 shadow-inner animate-pop-in"
      aria-label="Fundraising progress"
      role="region"
    >
      <div
        class="flex items-baseline justify-center gap-4 mb-4 text-yellow-300 font-extrabold text-3xl sm:text-4xl select-text"
      >
        $<span aria-live="polite" aria-atomic="true">{{ "{:,}".format(raised) }}</span>
        <span class="text-yellow-200 font-black text-xl">/</span>
        $<span>{{ "{:,}".format(goal) }}</span>
        <button
          class="ml-4 px-2 py-1 rounded-full bg-yellow-400/80 text-zinc-900 font-bold text-xs
                 hover:bg-yellow-300 focus-visible:ring-2 focus-visible:ring-yellow-600 transition-colors duration-200"
          onclick="navigator.clipboard.writeText(window.location.origin + '/donate'); this.innerHTML = 'Copied!'; setTimeout(() => this.innerHTML = 'Copy Link', 900);"
          title="Copy donation link"
          aria-label="Copy donation link"
          type="button"
        >
          Copy Link
        </button>
      </div>

      <div
        class="w-full rounded-full h-5 overflow-hidden mb-3"
        role="progressbar"
        aria-valuemin="0"
        aria-valuemax="{{ goal }}"
        aria-valuenow="{{ raised }}"
        aria-label="Fundraising progress bar"
      >
        <div
          class="bg-gradient-to-r from-yellow-400 to-yellow-200 h-5 rounded-full transition-all duration-700 ease-out"
          style="width: {{ pct }}%; min-width: 12px;"
        ></div>
      </div>

      <span
        class="block text-sm text-yellow-200 font-semibold select-text"
        aria-live="polite"
      >
        100% of your gift funds gym, travel &amp; tutoring.
      </span>
    </div>

    <!-- Confetti Container -->
    <div id="hero-confetti" class="pointer-events-none select-none absolute inset-0 z-40"></div>

  </div>

  {# Optional Mobile Sticky Donate CTA #}
  <div
    class="fixed bottom-0 left-0 right-0 z-50 bg-yellow-400 text-zinc-900 py-3 px-6 flex justify-center items-center gap-4
           font-extrabold text-lg uppercase tracking-wide cursor-pointer select-none
           md:hidden shadow-lg hover:bg-yellow-500 transition-colors duration-300"
    role="button"
    tabindex="0"
    aria-label="Donate now"
    onclick="window.location.href='/donate'"
    @keydown.enter.window="$event.target.click()"
  >
    Donate Now
  </div>
</section>

