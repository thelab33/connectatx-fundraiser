{% from "macros/progress.html" import progress_meter %}
{% from "macros/confetti.html" import launch_confetti %}

{# --- Hero Section Vars --- #}
{% set team_name = team.team_name | default('Connect ATX Elite', true) %}
{% set region = team.region | default("Austin, TX", true) %}
{% set logo_src = 'images/team-rings.webp' %}
{% set hero_img = (team.hero_image if team and team.hero_image else 'images/connect-atx-team.jpg') %}
{% set fallback_img = url_for('static', filename='images/connect-atx-team.jpg') %}
{% set impact = [
  {"v":"20+", "lbl":"Studentâ€‘Athletes"},
  {"v":"3.5+", "lbl":"GPA Average"},
  {"v":"100%", "lbl":"Funds to Access &amp; Education"}
] %}
{% set raised = stats.raised if stats is defined and stats.raised is defined else 0 %}
{% set goal = stats.goal if stats is defined and stats.goal is defined else 10000 %}
{% set pct = (raised / goal * 100) | round(1) if goal else 0 %}
{% set next_game = team.next_game if team and team.next_game else None %}
{% set next_game_dt = next_game.date if next_game and next_game.date else None %}
{% set recent_donors = recent_donors if recent_donors is defined else [] %}

<section
  id="hero"
  aria-labelledby="hero-heading"
  tabindex="-1"
  itemscope itemtype="https://schema.org/SportsTeam"
  class="relative w-screen max-w-none left-1/2 -translate-x-1/2 flex flex-col items-center justify-center
         min-h-[98vh] md:min-h-screen overflow-hidden py-36 px-6 sm:px-12
         bg-gradient-to-br from-blue-900 via-indigo-950 to-blue-800
         transition-transform duration-300 will-change-transform hover:scale-105"
  style="margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw);"
>

  <!-- Background Image with Fallback -->
  <img
    src="{{ url_for('static', filename=(hero_img if hero_img and '://' not in hero_img else 'images/' ~ hero_img)) }}"
    alt="{{ team_name }} team photo"
    loading="eager"
    decoding="async"
    aria-hidden="true"
    class="absolute inset-0 w-full h-full object-cover opacity-80 scale-110 animate-kenburns -z-10 pointer-events-none select-none
           shadow-[0_0_30px_rgba(251,191,36,0.7)] transition-transform duration-300 will-change-transform hover:scale-105"
    style="min-height: 520px; max-height: 100vh;"
    onerror="this.onerror=null;this.src='{{ url_for('static', filename='images/connect-atx.jpg') }}';"
    itemprop="image"
  />

  <!-- Cinematic overlays -->
  <div class="absolute inset-0 bg-gradient-to-b from-black/95 via-black/75 to-transparent -z-5"></div>
  <div class="absolute inset-x-0 top-0 h-2 bg-gradient-to-r from-yellow-300/50 via-transparent to-yellow-400/30 blur-lg z-10"></div>
  <div class="absolute left-0 top-0 h-full w-12 bg-gradient-to-r from-yellow-200/10 to-transparent z-10"></div>
  <div class="absolute right-0 top-0 h-full w-12 bg-gradient-to-l from-yellow-200/10 to-transparent z-10"></div>

  <!-- Basketball Net SVG Accent -->
  <svg
    class="absolute left-1/2 top-[calc(100%-36px)] -translate-x-1/2 z-10 w-28 md:w-40 opacity-25 pointer-events-none"
    viewBox="0 0 128 32"
    fill="none"
    aria-hidden="true"
  >
    <ellipse cx="64" cy="16" rx="63" ry="12" fill="#fffbe880" />
    <path d="M0 16 Q64 36 128 16" stroke="#eab308" stroke-width="2" fill="none" />
    <path d="M16 16 Q64 32 112 16" stroke="#eab308" stroke-width="1" fill="none" />
  </svg>

  <!-- Content -->
  <div class="relative z-30 flex flex-col items-center w-full px-6 sm:px-12 max-w-3xl mx-auto text-center space-y-7">

    <!-- Logo & Team -->
    <div class="flex flex-col items-center mb-4" role="img" aria-label="{{ team_name }} logo">
      <span class="relative inline-block mb-3 animate-fade-in-slow">
        <img
          src="{{ url_for('static', filename='images/team-rings.webp') }}"
          alt="Connect ATX Elite championship rings"
          class="h-20 sm:h-28 w-auto rounded-full bg-white/80 p-2 drop-shadow-xl ring-4 ring-amber-200/20 relative z-10"
          loading="eager"
          decoding="async"
          itemprop="logo"
        />
        <svg class="absolute -top-6 right-0 animate-spin-slow w-10 h-10 opacity-70"
             viewBox="0 0 32 32" fill="none" aria-hidden="true">
          <circle cx="16" cy="16" r="15" fill="#FBBF24" stroke="#92400E" stroke-width="2" />
          <path d="M8 16c5-3 11-3 16 0" stroke="#92400E" stroke-width="1" />
          <path d="M16 2v28" stroke="#92400E" stroke-width="1" />
        </svg>
      </span>
      <h1
        id="hero-heading"
        class="text-5xl sm:text-6xl font-extrabold text-yellow-300 tracking-tight leading-tight animate-shine"
        tabindex="0"
        aria-label="{{ team_name }}"
      >
        {{ team_name }}
      </h1>
      <p
        class="text-xl sm:text-2xl font-semibold text-white/95 drop-shadow mt-2 animate-fade-in-slow"
      >
        Family, Grit &amp; Honor â€” On and Off the Court
      </p>
    </div>

    <!-- Mission Statement -->
    <p
      class="max-w-xl text-yellow-100 font-bold text-lg sm:text-xl leading-relaxed mx-auto animate-fade-in"
      style="animation-delay: 0.3s"
    >
      Weâ€™re a <span class="text-amber-300 font-semibold">family-run AAU program</span> transforming East Austin youth into <span class="text-amber-300 font-semibold">scholar-athletes, leaders, and community champions</span>.
    </p>

    <!-- Impact Stats -->
    <div
      class="impact-stats flex flex-wrap justify-center gap-8 max-w-2xl mx-auto mb-8"
      role="list"
      aria-label="Team Impact Stats"
    >
      {% for s in impact %}
      <div
        class="min-w-[100px] bg-black/80 rounded-xl p-5 shadow-lg focus-within:ring-2 focus-within:ring-yellow-400 cursor-default select-text flex flex-col items-center animate-pop-in"
        tabindex="0"
        role="listitem"
        aria-label="{{ s.v }} {{ s.lbl }}"
      >
        <span class="block text-3xl sm:text-4xl font-extrabold text-yellow-300 animate-shine">{{ s.v }}</span>
        <span class="block mt-2 text-xs sm:text-sm uppercase text-yellow-100 tracking-wide text-center">{{ s.lbl }}</span>
      </div>
      {% endfor %}
    </div>

    <!-- VIP Sponsorship Bar -->
    <button
      type="button"
      class="vip-bar inline-flex items-center gap-3 mb-8 px-10 py-3 rounded-full bg-yellow-400 text-zinc-900 font-extrabold text-sm sm:text-base tracking-wider uppercase shadow-xl animate-bounce-in
             backdrop-blur-xl cursor-pointer focus-visible:ring-4 focus-visible:ring-yellow-500/90 transition-transform duration-300 hover:scale-105"
      role="alert"
      aria-live="polite"
      aria-atomic="true"
      tabindex="0"
      onclick="window.location.href='/vip'"
    >
      ðŸŒŸ Limited VIP Sponsorship
      <svg class="ml-2 w-5 h-5 animate-sparkle" fill="none" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M8 1v2M8 13v2M1 8h2M13 8h2M4.22 4.22l1.42 1.42M10.36 10.36l1.42 1.42M4.22 11.78l1.42-1.42M10.36 5.64l1.42-1.42" stroke="#fff" stroke-width="1.2" stroke-linecap="round"/>
      </svg>
      <span class="mx-3 text-yellow-700 font-bold animate-pulse">â€¢</span>
      <span class="hidden sm:inline">Secure your spot!</span>
    </button>

    <!-- Fundraising Progress Bar & Amount Raised -->
    <div
      class="flex flex-col items-center w-full max-w-sm mx-auto mb-4 bg-zinc-900/95 rounded-xl p-6 ring-1 ring-yellow-400/40 shadow-inner animate-pop-in"
      aria-label="Fundraising progress"
      role="region"
    >
      <div class="flex items-baseline justify-center gap-4 mb-4 text-yellow-300 font-extrabold text-3xl sm:text-4xl">
        $<span>{{ "{:,}".format(raised) }}</span>
        <span class="text-yellow-200 font-black text-xl">/</span>
        $<span>{{ "{:,}".format(goal) }}</span>
        <button
          class="ml-4 px-2 py-1 rounded-full bg-yellow-400/80 text-zinc-900 font-bold text-xs transition hover:bg-yellow-300 focus-visible:ring-2 focus-visible:ring-yellow-600"
          style="transition: box-shadow 0.3s;"
          onclick="navigator.clipboard.writeText(window.location.origin + '/donate'); this.innerHTML = 'Copied!'; setTimeout(() => this.innerHTML = 'Copy Link', 900);"
          title="Copy donation link"
          aria-label="Copy donation link"
          type="button"
        >
          Copy Link
        </button>
      </div>
      <div
        class="progress-container w-full rounded-full h-5 overflow-hidden mb-3"
        role="progressbar"
        aria-valuemin="0"
        aria-valuemax="{{ goal }}"
        aria-valuenow="{{ raised }}"
      >
        <div
          class="progress-bar bg-gradient-to-r from-yellow-400 to-yellow-200 h-5 rounded-full transition-[width] duration-700 ease-out"
          style="width: {{ pct }}%; min-width:12px;"
        ></div>
      </div>
      <span class="block text-sm text-yellow-200 font-semibold select-text" aria-live="polite">
        100% of your gift funds gym, travel & tutoring.
      </span>
    </div>

    <!-- Next Game Countdown -->
    {% if next_game_dt %}
    <div
      id="next-game-banner"
      class="mt-4 text-sm text-yellow-300 font-semibold flex items-center justify-center gap-3 bg-black/70 rounded-full px-6 py-2 shadow max-w-xs mx-auto animate-fade-in"
      role="region"
      aria-live="polite"
      aria-atomic="true"
    >
      <svg class="w-5 h-5 text-amber-300" fill="none" viewBox="0 0 20 20" aria-hidden="true">
        <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2" />
        <path d="M10 5v5l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>
      Next Game:
      <span id="next-game-countdown" class="ml-2 font-mono tabular-nums"></span>
    </div>
    {% endif %}

    <!-- Recent Donors -->
    {% if recent_donors and recent_donors|length > 0 %}
    <div
      class="recent-donors mt-4 flex flex-wrap justify-center gap-4 text-sm text-yellow-200/90"
      aria-live="polite"
      aria-atomic="true"
      role="list"
      aria-label="Recent Donors"
    >
      <span class="font-semibold text-yellow-300 self-center whitespace-nowrap">Recent Donors:</span>
      {% for donor in recent_donors[:4] %}
      <span
        style="--order: {{ loop.index0 }};"
        class="bg-yellow-400/20 px-3 py-1 rounded-full select-text fade-scale-in cursor-default whitespace-nowrap"
        role="listitem"
      >
        {{ donor }}
      </span>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Sponsorship Tiers Link -->
    <a
      href="#tiers"
      class="mt-8 inline-flex items-center text-amber-400 hover:underline hover:text-yellow-300 font-bold text-lg transition animate-pop-in"
      role="link"
    >
      <span class="mr-3">View Sponsorship Tiers</span>
      <svg
        class="h-5 w-5"
        fill="none"
        stroke="currentColor"
        stroke-width="3"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path d="M5 12h14M12 5l7 7-7 7" />
      </svg>
    </a>

    <!-- Confetti container -->
    <div id="hero-confetti" class="pointer-events-none select-none absolute inset-0 z-40"></div>
  </div>
</section>

<style>
  .shadow-gold-glow {
    box-shadow: 0 0 8px 2px rgba(251, 191, 36, 0.5), 0 0 20px 8px rgba(251, 191, 36, 0.2);
  }
  @keyframes subtle-shine {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  .animate-shine {
    background: linear-gradient(270deg, #fbbf24, #fde68a, #fbbf24);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: subtle-shine 6s ease-in-out infinite;
    opacity: 1 !important;
    visibility: visible !important;
  }
  /* Pop-in animation for stats & links */
  @keyframes pop-in { 0% { opacity:0; transform: scale(0.8);} 100% { opacity:1; transform: scale(1);} }
  .animate-pop-in { animation: pop-in 0.6s cubic-bezier(0.23,1,0.32,1) both; }
  /* Slow fade for heading/logo */
  @keyframes fade-in-slow { 0%{opacity:0;transform:translateY(16px);} 100%{opacity:1;transform:none;} }
  .animate-fade-in-slow { animation: fade-in-slow 1.2s cubic-bezier(0.4,0,0.2,1) both; }
  .animate-fade-in { animation: fade-in-slow 0.8s cubic-bezier(0.4,0,0.2,1) both; }
  /* Bouncy VIP */
  @keyframes bounce-in { 0%, 100% {transform:translateY(-16px) scale(0.98);} 80% {transform:none;} }
  .animate-bounce-in { animation: bounce-in 1s cubic-bezier(.33,1.81,.53,1.12) both;}
  /* Sparkle */
  @keyframes sparkle { 0%,100%{opacity:1;} 50%{opacity:.5;transform:rotate(-6deg);} }
  .animate-sparkle { animation: sparkle 1.2s infinite; }
  /* Donation copied feedback */
  .donation-copied { background:#ffe066 !important; color:#1a1a1a !important; }
</style>

{# Next Game Countdown script #}
{% if next_game_dt %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.getElementById('next-game-countdown');
    if (!el) return;
    const targetDate = new Date('{{ next_game_dt }}T00:00:00');
    function updateCountdown() {
      const now = new Date();
      const diff = targetDate - now;
      if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        el.textContent = days ? `In ${days}d ${hours}h` : hours ? `In ${hours}h` : 'Today!';
      } else {
        el.textContent = 'Happening now!';
      }
    }
    updateCountdown();
    setInterval(updateCountdown, 60 * 60 * 1000);
  });
</script>
{% endif %}

<script>
  // Confetti logic
  document.addEventListener('DOMContentLoaded', () => {
    const milestones = [25, 50, 75, 100];
    const pct = {{ pct|int }};
    if (milestones.includes(pct)) {
      if (typeof window.launch_confetti === 'function') {
        window.launch_confetti();
      } else if (document.getElementById('hero-confetti')) {
        if (window.confetti) window.confetti({ particleCount: 70, spread: 80, origin: { y: 0.3 } });
      }
    }
  });
</script>

