{# ===========================================================================
   macros/ui.html — FundChamps vanilla UI macros (2025)
   - No BOM, UTF-8
   - No custom filters required
   - Works with Tailwind v3
=========================================================================== #}

{# ===========================================================================
   PROGRESS METER
   Animated, responsive, accessible fundraising progress bar
=========================================================================== #}
{% macro progress_meter(raised, goal, size="md") -%}
  {# Compute percentage, clamp to 0..100 #}
  {%- set _goal = goal | float if goal else 0.0 -%}
  {%- set _raised = raised | float if raised else 0.0 -%}
  {%- set _pct = (0.0 if _goal == 0.0 else (_raised / _goal * 100.0)) -%}
  {%- set _pct = (_pct if _pct >= 0.0 else 0.0) | min(100.0) -%}
  {%- set pct_f = '%.1f' % _pct -%}
  {%- set raised_display = '{:,}'.format(raised | int) -%}

  {%- set sizes = {
    "sm": "max-w-[7.5rem] h-2 text-[10px] py-0.5",
    "md": "max-w-xs h-3 text-[11px] py-1",
    "lg": "max-w-sm h-4 text-xs py-2"
  } -%}

  <div
    x-data="{
      pct: {{ '%.2f' % _pct }},
      init() {
        if (this.$refs.bar) {
          this.$refs.bar.style.width = this.pct + '%';
        }
        if (this.pct >= 100) {
          import('https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/+esm')
            .then(m => m.default({ particleCount: 120, origin: { y: 0.8 } }))
            .catch(() => {});
        }
      }
    }"
    x-init="init()"
    role="progressbar"
    aria-label="Fundraising progress"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="{{ pct_f }}"
    aria-valuetext="{{ pct_f }} percent"
    class="relative w-full {{ sizes.get(size, sizes['md']) }} select-none"
  >
    <!-- Background rail -->
    <div class="w-full bg-zinc-800/70 rounded-full overflow-hidden shadow-inner" style="height: inherit;">
      <div
        x-ref="bar"
        class="h-full w-0 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-300 transition-all duration-700 ease-out"
        style="min-width:6px"
      ></div>
    </div>

    <!-- Centered progress label -->
    <div class="absolute inset-0 flex items-center justify-center font-bold leading-none pointer-events-none" style="font-size: inherit;">
      <span class="text-yellow-300 drop-shadow">
        ${{ raised_display }} • {{ pct_f }}%
      </span>
    </div>
  </div>
{%- endmacro %}

{# ===========================================================================
   BUTTON
   Multi-color, multi-size, accessible, optional spinner & icon
=========================================================================== #}
{% macro render_button(label, href="#", color="primary", size="md", icon=None, loading=False, external=False, aria_label=None, extra_classes="", type="button") -%}
  {%- set COLORS = {
    "primary":   {"bg":"bg-yellow-400 hover:bg-yellow-300 text-zinc-900", "text":"text-yellow-400"},
    "secondary": {"bg":"bg-zinc-800 hover:bg-zinc-700 text-yellow-300",  "text":"text-yellow-300"},
    "danger":    {"bg":"bg-red-600 hover:bg-red-500 text-white",         "text":"text-red-600"},
    "success":   {"bg":"bg-green-600 hover:bg-green-500 text-white",     "text":"text-green-600"}
  } -%}
  {%- set SIZES = {
    "sm": "px-3 py-1.5 text-sm",
    "md": "px-4 py-2 text-sm",
    "lg": "px-5 py-2.5 text-base"
  } -%}

  {# Default fallback for any empty values #}
  {%- set label = label or 'Click Here' %}
  {%- set href = href or '#' %}
  {%- set icon = icon or '' %}

  {# Error handling for potential empty or malformed URL #}
  {% if not href.startswith('http') %}
    {% if href == "#" %}
      {% set href = "javascript:void(0);" %}
    {% else %}
      {% set href = "#" %}
    {% endif %}
  {% endif %}

  <a
    href="{{ href }}"
    role="button"
    tabindex="0"
    class="inline-flex items-center justify-center font-semibold rounded-xl shadow transition
           focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-300/80 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950
           {{ COLORS.get(color, COLORS['primary']).bg }}
           {{ SIZES.get(size, SIZES['md']) }}
           {{ extra_classes }}
           {% if loading %}opacity-60 pointer-events-none{% endif %}"
    {% if external %}target="_blank" rel="noopener noreferrer"{% endif %}
    {% if aria_label %}aria-label="{{ aria_label }}"{% endif %}
    type="{{ type }}"  <!-- Handle the type argument here -->
  >
    {% if icon %}
      <span class="mr-2 inline-flex items-center" aria-hidden="true">
        {% if icon is string and icon.startswith('fa') %}
          <i class="{{ icon }}"></i>
        {% else %}
          {{ icon }}
        {% endif %}
      </span>
    {% endif %}

    {% if loading %}
      <span
        class="inline-block w-4 h-4 mr-2 -2  -t-transparent rounded-full animate-spin"
        aria-hidden="true"
      ></span>
    {% endif %}

    <span class="align-middle">{{ label | safe }}</span>  {# Ensure the label is rendered as safe text #}
  </a>
{%- endmacro %}

