{# ==============================
   FUNDCHAMPS SPONSOR WALL WIDGET
   ============================== #}

{% from "macros/sponsor_card.html" import sponsor_card %}

<section
  id="sponsor-wall-widget"
  class="fixed bottom-8 right-8 z-50 max-w-md w-full max-h-[85vh] rounded-3xl bg-gradient-to-br from-zinc-900/95 via-zinc-900/90 to-yellow-900/90 shadow-[0_6px_40px_0_rgba(251,191,36,0.12)] ring-2 ring-yellow-400/60 backdrop-blur-lg opacity-0 pointer-events-none transition-all duration-500 ease-out transform translate-y-8 scale-95"
  role="dialog"
  aria-modal="true"
  aria-labelledby="sponsor-wall-title"
  aria-describedby="sponsor-wall-desc"
  tabindex="-1"
  aria-hidden="true"
  aria-live="polite"
  aria-atomic="true"
>
  <!-- ===== 1. Header ===== -->
  <header class="flex items-center justify-between px-6 py-4 border-b border-yellow-400/30 bg-gradient-to-r from-yellow-400/10 to-yellow-400/0 rounded-t-3xl">
    <h2 id="sponsor-wall-title" class="text-2xl sm:text-3xl font-black tracking-tight bg-gradient-to-r from-yellow-400 via-amber-300 to-yellow-400 bg-clip-text text-transparent drop-shadow-lg flex items-center gap-2">
      <span class="animate-wiggle text-3xl">ðŸ™Œ</span> Meet Our Champions
    </h2>
    <button id="sponsor-wall-close" aria-label="Close sponsor wall"
      class="text-yellow-400 hover:text-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-full transition text-2xl font-bold w-10 h-10 flex items-center justify-center bg-zinc-800/60 hover:bg-yellow-400/20 backdrop-blur-sm">
      âœ•
    </button>
  </header>

  <!-- ===== 2. Live Donation Ticker ===== -->
  <div id="donation-ticker" class="w-full py-1 px-4 bg-yellow-400/10 text-yellow-300 text-xs font-mono tracking-wide whitespace-nowrap overflow-x-auto border-b border-yellow-400/15">
    <span id="ticker-inner">
      {% for donation in recent_donations %}
        ðŸ’¸ <strong>{{ donation.sponsor_name }}</strong> just donated ${{ donation.amount|int|comma }}! &nbsp;&nbsp;
      {% endfor %}
    </span>
  </div>

  <!-- ===== 3. Description / Impact ===== -->
  <div id="sponsor-wall-desc"
    class="px-6 py-3 text-yellow-300 font-semibold text-[1rem] sm:text-base border-b border-yellow-400/20 flex flex-wrap items-center gap-2">
    <span>
      <span class="inline-block px-2 py-0.5 rounded-lg bg-yellow-500/20 font-bold text-yellow-200 tracking-wide animate-pop">
        {{ sponsors_sorted|length or 0 }} supporters
      </span>
      &mdash;
      <span class="inline-block px-2 py-0.5 rounded-lg bg-yellow-500/10 font-bold text-yellow-100 tracking-wide animate-pop-slow">
        ${{ sponsors_total|int|comma|default(0) }} raised
      </span>
    </span>
    <span class="hidden sm:inline-block text-yellow-400/80 ml-2">ðŸš€</span>
    <span class="text-xs text-yellow-200/70 ml-auto animate-pulse">Directly funds local youth programs!</span>
  </div>

  <!-- ===== 4. Leaderboard Toggle ===== -->
  <div class="flex justify-end gap-2 items-center px-6 pt-2">
    <button type="button" class="leaderboard-toggle text-xs sm:text-sm font-bold py-1 px-3 rounded bg-yellow-400/20 hover:bg-yellow-400/40 transition focus:outline-none focus:ring-2 focus:ring-yellow-400"
      data-type="all">All-Time</button>
    <button type="button" class="leaderboard-toggle text-xs sm:text-sm font-bold py-1 px-3 rounded bg-yellow-400/20 hover:bg-yellow-400/40 transition focus:outline-none focus:ring-2 focus:ring-yellow-400"
      data-type="month">This Month</button>
  </div>

  <!-- ===== 5. VIP Row (Top 3 Sponsors, sticky, confetti) ===== -->
  <div class="sticky top-0 z-10 bg-gradient-to-b from-zinc-900/95 to-transparent rounded-t-2xl py-2 mb-2 flex flex-row gap-2 justify-center items-center shadow-md">
    {% for sponsor in sponsors_sorted[:3] %}
      {{ sponsor_card(sponsor, loop.index, true) }}
    {% endfor %}
  </div>

  <!-- ===== 6. Sponsor Grid (Card Macro) ===== -->
  <div id="sponsor-wall-list"
    class="p-6 overflow-y-auto max-h-[calc(85vh-240px)] grid gap-5 sm:grid-cols-2 md:grid-cols-3 relative"
    role="list" tabindex="0" aria-label="Sponsor List">
    {% for sponsor in sponsors_sorted[3:] %}
      {{ sponsor_card(sponsor, loop.index + 3, false) }}
    {% endfor %}
    {# Fill empty slots (up to 12) â€” Upsell! #}
    {% set slots = (12 - sponsors_sorted|length) if sponsors_sorted|length < 12 else 0 %}
    {% for _ in range(slots) %}
      <div
        class="flex flex-col items-center justify-center min-h-[180px] rounded-2xl bg-zinc-800/70 text-yellow-200/70 shadow-inner p-4 border border-yellow-400/30 border-dashed cursor-pointer hover:bg-yellow-400/10 focus:bg-yellow-400/20 transition focus:outline-none focus:ring-2 focus:ring-yellow-400 group animate-pop"
        role="listitem"
        aria-label="Available sponsorship spot"
        tabindex="0"
        onclick="openSponsorModal()"
        onkeydown="if(event.key==='Enter' || event.key===' ') { event.preventDefault(); openSponsorModal(); }"
      >
        <span class="text-3xl mb-1 animate-bounce select-none" aria-hidden="true">âœ¨</span>
        <span class="text-center font-extrabold mb-1 select-none">Your Logo Here</span>
        <span class="text-xs text-zinc-400 mb-2 select-none group-hover:text-yellow-300 transition">Limited premium slots left!</span>
        <button type="button" class="rounded-full bg-yellow-400 px-5 py-2 font-black text-black shadow-md transition hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-xs" aria-label="Become a Sponsor" tabindex="-1">
          ðŸŒŸ Become a Sponsor
        </button>
      </div>
    {% endfor %}
  </div>

  <!-- ===== 7. Footer CTA + Social Share ===== -->
  <footer class="px-6 py-4 border-t border-yellow-400/20 text-center bg-zinc-900/80 rounded-b-3xl">
    <button type="button" onclick="openSponsorModal()"
      class="inline-block rounded-full bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 px-8 py-3 font-black text-black shadow-xl transition hover:bg-yellow-300/80 focus:outline-none focus:ring-2 focus:ring-yellow-400 active:scale-95 text-lg tracking-tight animate-pop"
      aria-label="Become a Sponsor">
      Become a Sponsor &rarr;
    </button>
    <div class="text-xs text-yellow-300/60 mt-1 italic">Brand your business, inspire kids, make an impact.</div>
    <div class="flex gap-2 justify-center mt-3">
      <button onclick="shareSponsorWall('x')" aria-label="Share on X" class="p-2 rounded-full bg-zinc-800 text-yellow-400 hover:bg-yellow-500/30">
        <svg viewBox="0 0 24 24" width="20" height="20"><!-- X icon --></svg>
      </button>
      <button onclick="shareSponsorWall('fb')" aria-label="Share on Facebook" class="p-2 rounded-full bg-zinc-800 text-blue-500 hover:bg-blue-400/30">
        <svg viewBox="0 0 24 24" width="20" height="20"><!-- FB icon --></svg>
      </button>
      <button onclick="shareSponsorWall('ln')" aria-label="Share on LinkedIn" class="p-2 rounded-full bg-zinc-800 text-blue-700 hover:bg-blue-600/30">
        <svg viewBox="0 0 24 24" width="20" height="20"><!-- LinkedIn icon --></svg>
      </button>
    </div>
  </footer>
</section>

<!-- ===== 8. Floating Toggle Button + Nudge ===== -->
<button id="sponsor-wall-toggle"
  aria-expanded="false"
  aria-controls="sponsor-wall-widget"
  aria-label="Open Sponsor Wall"
  class="fixed bottom-8 right-8 z-50 rounded-full bg-yellow-400 shadow-2xl p-4 text-black font-extrabold hover:bg-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition-all transform active:scale-95 drop-shadow-lg animate-pop"
>
  ðŸ™Œ <span class="hidden sm:inline">Sponsors</span>
  <span id="sponsor-nudge-dot" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-pink-500 animate-pulse hidden"></span>
</button>

<!-- ===== 9. Modal Placeholder (Load dynamically or slot your own) ===== -->
<div id="sponsor-modal-root"></div>

<!-- ===== 10. Styles & Script (paste in <style> and <script> tags) ===== -->

<script>@keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 70% { transform: scale(1.1); opacity: 1;} 100% { transform: scale(1); } }
.animate-pop { animation: pop 0.7s cubic-bezier(.2,1.7,.7,1) both; }
.animate-pop-slow { animation: pop 1.2s cubic-bezier(.2,1.7,.7,1) both; }
@keyframes wiggle { 0%,100% { transform: rotate(-8deg);} 50% { transform: rotate(8deg);} }
.animate-wiggle { animation: wiggle 1.4s infinite alternate; }
.animate-bounce { animation: bounce 1.2s infinite; }
@keyframes vip-glow { 0%,100% { box-shadow: 0 0 12px 4px #facc15bb, 0 0 0 0 transparent;} 50% { box-shadow: 0 0 32px 8px #facc15cc, 0 0 0 8px #fffbe7aa;} }
.animate-vip-glow { animation: vip-glow 2.5s infinite alternate; }
@keyframes vip-pop { 0%{ transform:scale(1.13); } 100%{ transform:scale(1); } }
.animate-vip-pop { animation: vip-pop 0.6s cubic-bezier(.17,2,.7,1.2) both; }
@keyframes confetti-burst { 0% { opacity:0; transform: scale(0.4) rotate(-40deg);} 60% { opacity:1; transform: scale(1.2) rotate(12deg);} 100% { opacity:0; transform: scale(0.2) rotate(60deg);} }
.animate-vip-confetti { animation: confetti-burst 1.2s cubic-bezier(.2,1.4,.7,1.2) 1; }
#sponsor-wall-widget[aria-hidden="false"] { opacity: 1 !important; pointer-events: auto !important; transform: translateY(0) scale(1) !important; }
#sponsor-wall-list::-webkit-scrollbar { width: 8px;}
#sponsor-wall-list::-webkit-scrollbar-thumb { background-color: rgba(250, 204, 21, 0.5); border-radius: 4px;}
#sponsor-wall-list.scroll-shadow::before { content: ""; position: sticky; top: 0; height: 8px; width: 100%; background: linear-gradient(to bottom, rgba(250,204,21,0.21), transparent); pointer-events: none; z-index: 10; }
@media (prefers-reduced-motion: reduce) { #sponsor-wall-widget, #sponsor-wall-toggle { transition: none !important; animation: none !important; } }
</script>

<script>
(() => {
  const toggleBtn = document.getElementById('sponsor-wall-toggle');
  const widget = document.getElementById('sponsor-wall-widget');
  const closeBtn = document.getElementById('sponsor-wall-close');
  const sponsorList = document.getElementById('sponsor-wall-list');
  const ticker = document.getElementById('ticker-inner');
  const nudgeDot = document.getElementById('sponsor-nudge-dot');
  // Modal/Share placeholders
  window.openSponsorModal = () => alert("ðŸš€ Replace with your Sponsorship Modal logic!");
  window.shareSponsorWall = (network) => {
    const shareUrl = window.location.href;
    if (navigator.share) {
      navigator.share({ title: 'Support Our Team!', url: shareUrl });
    } else {
      // Fallback open window to network (implement as needed)
      alert('Social sharing for ' + network + ' coming soon!');
    }
  }
  // Confetti effect (implement your own or use a lib)
  window.launchConfetti = () => { /* TODO: Add confetti effect here */ };
  // Welcome toast (replace with a lib like Toastify for best UX)
  window.welcomeSponsor = (name) => {
    launchConfetti();
    alert(`ðŸŽ‰ Welcome, ${name}!`);
  }
  function focusTrap(e) {
    const els = widget.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (!els.length) return;
    const first = els[0], last = els[els.length - 1];
    if (e.key === 'Tab') {
      if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
    }
  }
  function openWidget() {
    widget.setAttribute('aria-hidden', 'false');
    widget.focus();
    toggleBtn.setAttribute('aria-expanded', 'true');
    checkScrollShadow();
    document.body.style.overflow = 'hidden';
    if (nudgeDot) nudgeDot.classList.add('hidden');
  }
  function closeWidget() {
    widget.setAttribute('aria-hidden', 'true');
    toggleBtn.setAttribute('aria-expanded', 'false');
    toggleBtn.focus();
    document.body.style.overflow = '';
  }
  toggleBtn.addEventListener('click', () => {
    const isOpen = widget.getAttribute('aria-hidden') === 'false';
    isOpen ? closeWidget() : openWidget();
  });
  closeBtn.addEventListener('click', closeWidget);
  widget.addEventListener('keydown', e => {
    if (e.key === 'Escape') { e.preventDefault(); closeWidget(); }
    focusTrap(e);
  });
  document.addEventListener('click', e => {
    if (!widget.contains(e.target) && e.target !== toggleBtn) closeWidget();
  });
  function checkScrollShadow() {
    sponsorList.scrollTop > 5 ? sponsorList.classList.add('scroll-shadow') : sponsorList.classList.remove('scroll-shadow');
  }
  sponsorList.addEventListener('scroll', checkScrollShadow);
  // Leaderboard toggle logic (plug in HTMX/Socket.IO here)
  document.querySelectorAll('.leaderboard-toggle').forEach(btn => {
    btn.addEventListener('click', (e) => {
      document.querySelectorAll('.leaderboard-toggle').forEach(b => b.classList.remove('bg-yellow-400/40'));
      btn.classList.add('bg-yellow-400/40');
      // TODO: Fetch and update sponsor list by leaderboard type (all/month)
    });
  });
  // Live ticker update (plug in Socket.IO or HTMX swap here)
  // TODO: ticker.innerHTML = newDonationFeed;
  // Smart nudge â€” after 3min closed, pulse dot
  setTimeout(() => {
    if (widget.getAttribute('aria-hidden') === 'true' && nudgeDot) {
      nudgeDot.classList.remove('hidden');
    }
  }, 180_000);
  // Keyboard shortcut: 'S' toggles sponsor wall
  document.addEventListener('keydown', e => {
    if (e.key.toLowerCase() === 's' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) {
      e.preventDefault();
      const isOpen = widget.getAttribute('aria-hidden') === 'false';
      isOpen ? closeWidget() : openWidget();
    }
  });
})();
</script>
